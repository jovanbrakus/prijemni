<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dužina tetive kruga čija je sredina u datoj tački</title>
<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script type="text/info" id="logic-scratchpad">
Problem: Dužina tetive kruga x² + y² + 4x - 4y - 17 = 0 čija je sredina u tački P(0,3).

Step 1: Svesti jednačinu kruga na kanonski oblik
  x² + y² + 4x - 4y - 17 = 0
  (x² + 4x + 4) + (y² - 4y + 4) - 17 - 4 - 4 = 0
  (x + 2)² + (y - 2)² = 25

Step 2: Identifikovati centar i poluprečnik
  Centar: C(-2, 2)
  Poluprečnik: r = √25 = 5

Step 3: Rastojanje od centra C(-2, 2) do sredine tetive P(0, 3)
  d = √((0 - (-2))² + (3 - 2)²)
  d = √(4 + 1)
  d = √5

Step 4: Polovina dužine tetive (Pitagorina teorema u pravouglom trouglu)
  Duž od centra do sredine tetive je normalna na tetivu.
  Imamo pravougli trougao: hipotenuza = r = 5, jedna kateta = d = √5
  Druga kateta (polovina tetive) = √(r² - d²) = √(25 - 5) = √20 = 2√5

Step 5: Puna dužina tetive
  L = 2 × 2√5 = 4√5

Odgovor: (C) 4√5
</script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

h1 {
  font-size: 2.2rem;
  font-weight: 800;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  line-height: 1.3;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1rem;
  margin-bottom: 30px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

.card h2 {
  color: #60a5fa;
  font-size: 1.4rem;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card h3 {
  color: #a78bfa;
  font-size: 1.15rem;
  margin: 18px 0 10px 0;
}

.problem-statement {
  background: linear-gradient(135deg, rgba(96,165,250,0.1), rgba(167,139,250,0.1));
  border: 1px solid rgba(96,165,250,0.3);
  border-radius: 12px;
  padding: 20px;
  font-size: 1.15rem;
  line-height: 1.8;
  margin-bottom: 10px;
}

.options-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  margin-top: 14px;
}

.option {
  background: #0f172a;
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 10px 14px;
  text-align: center;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.option.correct {
  border-color: #34d399;
  background: rgba(52, 211, 153, 0.1);
  color: #34d399;
  font-weight: bold;
}

.plan-box {
  background: rgba(167,139,250,0.08);
  border-left: 4px solid #a78bfa;
  border-radius: 0 10px 10px 0;
  padding: 16px 20px;
  margin-bottom: 10px;
}

.plan-box ol {
  padding-left: 20px;
}

.plan-box li {
  margin-bottom: 6px;
  color: #cbd5e1;
}

.collapsible-toggle {
  background: rgba(96,165,250,0.1);
  border: 1px solid rgba(96,165,250,0.3);
  color: #60a5fa;
  padding: 12px 18px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1rem;
  width: 100%;
  text-align: left;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}

.collapsible-toggle:hover {
  background: rgba(96,165,250,0.2);
}

.collapsible-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease;
}

.collapsible-content.open {
  max-height: 2000px;
}

.collapsible-inner {
  padding: 18px 4px 4px 4px;
  color: #cbd5e1;
  line-height: 1.8;
}

.step-card {
  background: #0f172a;
  border: 1px solid #334155;
  border-radius: 10px;
  padding: 18px;
  margin-bottom: 16px;
  position: relative;
  border-left: 4px solid #60a5fa;
}

.step-card.green-step {
  border-left-color: #34d399;
}

.step-card.purple-step {
  border-left-color: #a78bfa;
}

.step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  border-radius: 50%;
  font-weight: 800;
  font-size: 0.9rem;
  color: #0f172a;
  margin-bottom: 10px;
}

.checkpoint {
  background: rgba(244,114,182,0.08);
  border: 1px dashed #f472b6;
  border-radius: 10px;
  padding: 14px 18px;
  margin: 14px 0;
}

.checkpoint-btn {
  background: linear-gradient(135deg, #f472b6, #a78bfa);
  color: #0f172a;
  border: none;
  padding: 8px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 700;
  font-size: 0.95rem;
  margin-top: 8px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.checkpoint-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(244,114,182,0.4);
}

.checkpoint-answer {
  display: none;
  margin-top: 10px;
  padding: 10px 14px;
  background: rgba(52,211,153,0.08);
  border-radius: 8px;
  color: #4ade80;
}

.final-answer {
  background: linear-gradient(135deg, rgba(52,211,153,0.1), rgba(74,222,128,0.1));
  border: 2px solid #34d399;
  border-radius: 14px;
  padding: 24px;
  text-align: center;
}

.final-answer .answer-value {
  font-size: 2rem;
  font-weight: 800;
  color: #4ade80;
  margin: 10px 0;
}

.final-options {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin-top: 16px;
}

.final-option {
  padding: 8px 18px;
  border-radius: 8px;
  font-size: 1rem;
  border: 1px solid #334155;
  background: #0f172a;
  color: #94a3b8;
}

.final-option.correct {
  border-color: #34d399;
  background: rgba(52,211,153,0.15);
  color: #4ade80;
  font-weight: bold;
}

.insight-box {
  background: linear-gradient(135deg, rgba(250,204,21,0.08), rgba(251,191,36,0.08));
  border: 1px solid rgba(250,204,21,0.3);
  border-left: 4px solid #fbbf24;
  border-radius: 0 12px 12px 0;
  padding: 18px 20px;
  color: #fde68a;
  line-height: 1.8;
}

.pitfall-item {
  background: rgba(239,68,68,0.08);
  border: 1px solid rgba(239,68,68,0.2);
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 10px;
  color: #fca5a5;
}

.pitfall-item strong {
  color: #f87171;
}

.challenge-box {
  background: rgba(167,139,250,0.08);
  border: 1px solid rgba(167,139,250,0.3);
  border-radius: 12px;
  padding: 18px;
  color: #c4b5fd;
}

canvas {
  display: block;
  margin: 0 auto;
  border-radius: 12px;
  border: 1px solid #334155;
  background: #0f172a;
  max-width: 100%;
  touch-action: none;
}

.canvas-controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.canvas-btn {
  background: rgba(96,165,250,0.15);
  border: 1px solid rgba(96,165,250,0.3);
  color: #60a5fa;
  padding: 6px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.canvas-btn:hover {
  background: rgba(96,165,250,0.3);
}

.canvas-btn.active {
  background: rgba(96,165,250,0.3);
  border-color: #60a5fa;
}

.canvas-info {
  text-align: center;
  margin-top: 8px;
  color: #94a3b8;
  font-size: 0.9rem;
}

@media (max-width: 700px) {
  body { padding: 10px; }
  .container { padding: 10px; }
  h1 { font-size: 1.5rem; }
  .card { padding: 16px; }
  .options-grid { grid-template-columns: repeat(3, 1fr); }
  canvas { height: 350px; }
}
</style>
</head>
<body>
<div class="container">

  <h1>Dužina tetive kruga sa datom sredinom</h1>
  <p class="subtitle">ETF Beograd 2010 — Zadatak 4 | Analitička geometrija</p>

  <!-- ZADATAK -->
  <div class="card">
    <h2>Zadatak</h2>
    <div class="problem-statement">
      Dužina one tetive kruga \(x^2 + y^2 + 4x - 4y - 17 = 0\), čija je sredina u tački \(P(0,\, 3)\), jednaka je:
    </div>
    <div class="options-grid">
      <div class="option">(A) \(\sqrt{5}\)</div>
      <div class="option">(B) \(2\sqrt{5}\)</div>
      <div class="option correct">(C) \(4\sqrt{5}\)</div>
      <div class="option">(D) \(5\sqrt{5}\)</div>
      <div class="option">(E) \(6\sqrt{5}\)</div>
      <div class="option">(N) Ne znam</div>
    </div>
  </div>

  <!-- PLAN -->
  <div class="card">
    <h2>Plan rešavanja</h2>
    <div class="plan-box">
      <ol>
        <li>Svesti jednačinu kruga na kanonski oblik — naći centar i poluprečnik</li>
        <li>Izračunati rastojanje od centra kruga do sredine tetive \(P(0,\,3)\)</li>
        <li>Primeniti Pitagorinu teoremu u pravouglom trouglu (centar, sredina tetive, kraj tetive)</li>
        <li>Izračunati punu dužinu tetive</li>
      </ol>
    </div>
  </div>

  <!-- TEORIJA -->
  <div class="card">
    <h2>Teorija</h2>
    <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
      Veza centra kruga, sredine tetive i dužine tetive
      <span class="arrow">&#9660;</span>
    </button>
    <div class="collapsible-content">
      <div class="collapsible-inner">
        <h3>Kanonski oblik jednačine kruga</h3>
        <p>Opšti oblik jednačine kruga je:</p>
        \[x^2 + y^2 + Dx + Ey + F = 0\]
        <p>Dopunjavanjem do potpunog kvadrata dobijamo kanonski oblik:</p>
        \[(x - a)^2 + (y - b)^2 = r^2\]
        <p>gde je \(C(a,\, b)\) centar kruga, a \(r\) je poluprečnik.</p>

        <h3>Tetiva i njena sredina</h3>
        <p><strong>Tetiva</strong> je duž koja spaja dve tačke na krugu. Ključna osobina:</p>
        <p style="padding: 10px; background: rgba(96,165,250,0.1); border-radius: 8px; margin: 10px 0;">
          Duž od centra kruga do sredine tetive je <strong>normalna</strong> (upravna) na tu tetivu.
        </p>
        <p>Zato centar \(C\), sredina tetive \(P\) i kraj tetive \(A\) čine <strong>pravougli trougao</strong> sa pravim uglom u tački \(P\).</p>

        <h3>Formula za dužinu tetive</h3>
        <p>Ako je \(r\) poluprečnik, a \(d\) rastojanje od centra do sredine tetive, onda je polovina dužine tetive:</p>
        \[\frac{L}{2} = \sqrt{r^2 - d^2}\]
        <p>pa je puna dužina tetive:</p>
        \[L = 2\sqrt{r^2 - d^2}\]
      </div>
    </div>
  </div>

  <!-- VIZUELNI PRIKAZ -->
  <div class="card">
    <h2>Interaktivni dijagram</h2>
    <canvas id="geoCanvas" width="600" height="520"></canvas>
    <div class="canvas-controls">
      <button class="canvas-btn active" id="btnDrag" onclick="setMode('drag')">Pomeri tačku P</button>
      <button class="canvas-btn" id="btnReset" onclick="resetCanvas()">Resetuj</button>
    </div>
    <div class="canvas-info" id="canvasInfo">
      Prevuci tačku P duž kruga da vidiš kako se menja dužina tetive.
    </div>
  </div>

  <!-- KORAK PO KORAK -->
  <div class="card">
    <h2>Rešenje korak po korak</h2>

    <!-- Korak 1 -->
    <div class="step-card">
      <div class="step-number">1</div>
      <h3>Svedemo jednačinu kruga na kanonski oblik</h3>
      <p>Polazimo od:</p>
      \[x^2 + y^2 + 4x - 4y - 17 = 0\]
      <p>Grupišemo i dopunjujemo do potpunog kvadrata:</p>
      \[(x^2 + 4x) + (y^2 - 4y) = 17\]
      \[(x^2 + 4x + 4) + (y^2 - 4y + 4) = 17 + 4 + 4\]
      \[(x + 2)^2 + (y - 2)^2 = 25\]
      <p>Dakle, krug ima:</p>
      <ul style="padding-left: 20px; margin-top: 6px;">
        <li>Centar: \(C(-2,\, 2)\)</li>
        <li>Poluprečnik: \(r = \sqrt{25} = 5\)</li>
      </ul>
    </div>

    <!-- Checkpoint 1 -->
    <div class="checkpoint">
      <strong>Proveri se!</strong> Koliki je poluprečnik kruga?
      <br>
      <button class="checkpoint-btn" onclick="showAnswer(this)">Prikaži odgovor</button>
      <div class="checkpoint-answer">
        Poluprečnik je \(r = 5\). Centar kruga je u tački \(C(-2,\, 2)\).
      </div>
    </div>

    <!-- Korak 2 -->
    <div class="step-card purple-step">
      <div class="step-number">2</div>
      <h3>Izračunamo rastojanje od centra do sredine tetive</h3>
      <p>Sredina tetive je \(P(0,\, 3)\), a centar kruga je \(C(-2,\, 2)\).</p>
      <p>Rastojanje:</p>
      \[d = |CP| = \sqrt{(0 - (-2))^2 + (3 - 2)^2}\]
      \[d = \sqrt{2^2 + 1^2} = \sqrt{4 + 1} = \sqrt{5}\]
    </div>

    <!-- Checkpoint 2 -->
    <div class="checkpoint">
      <strong>Proveri se!</strong> Koliko iznosi rastojanje od centra kruga do tačke \(P\)?
      <br>
      <button class="checkpoint-btn" onclick="showAnswer(this)">Prikaži odgovor</button>
      <div class="checkpoint-answer">
        Rastojanje iznosi \(d = \sqrt{5} \approx 2{,}236\). Pošto je \(d < r\) (tj. \(\sqrt{5} < 5\)), tačka \(P\) se nalazi unutar kruga — što i mora biti slučaj za sredinu tetive.
      </div>
    </div>

    <!-- Korak 3 -->
    <div class="step-card green-step">
      <div class="step-number">3</div>
      <h3>Primenimo Pitagorinu teoremu</h3>
      <p>Duž od centra \(C\) do sredine tetive \(P\) je normalna na tetivu. Formira se pravougli trougao \(\triangle CPA\), gde je \(A\) jedan kraj tetive:</p>
      <ul style="padding-left: 20px; margin: 8px 0;">
        <li>Hipotenuza: \(CA = r = 5\) (poluprečnik)</li>
        <li>Kateta: \(CP = d = \sqrt{5}\) (rastojanje centar–sredina tetive)</li>
        <li>Kateta: \(PA = \frac{L}{2}\) (polovina tetive)</li>
      </ul>
      \[\left(\frac{L}{2}\right)^2 = r^2 - d^2 = 25 - 5 = 20\]
      \[\frac{L}{2} = \sqrt{20} = 2\sqrt{5}\]
    </div>

    <!-- Korak 4 -->
    <div class="step-card">
      <div class="step-number">4</div>
      <h3>Izračunamo punu dužinu tetive</h3>
      \[L = 2 \cdot \frac{L}{2} = 2 \cdot 2\sqrt{5} = 4\sqrt{5}\]
      <p>Numerički: \(4\sqrt{5} \approx 4 \cdot 2{,}236 = 8{,}944\).</p>
    </div>
  </div>

  <!-- KLJUČNI UVID -->
  <div class="card">
    <h2>Ključni uvid</h2>
    <div class="insight-box">
      <p><strong>Normala iz centra na tetivu:</strong> Svaki put kada treba naći dužinu tetive kojoj je poznata sredina, osloni se na činjenicu da je <strong>duž od centra kruga do sredine tetive normalna na tu tetivu</strong>. To automatski kreira pravougli trougao u kome se primenjuje Pitagorina teorema.</p>
      <p style="margin-top: 10px;">Formula: \(\displaystyle L = 2\sqrt{r^2 - d^2}\), gde je \(d\) rastojanje od centra do sredine tetive.</p>
    </div>
  </div>

  <!-- KONAČAN ODGOVOR -->
  <div class="card">
    <h2>Konačan odgovor</h2>
    <div class="final-answer">
      <p>Dužina tetive jednaka je:</p>
      <div class="answer-value">\(4\sqrt{5}\)</div>
      <div class="final-options">
        <span class="final-option">(A) \(\sqrt{5}\)</span>
        <span class="final-option">(B) \(2\sqrt{5}\)</span>
        <span class="final-option correct">(C) \(4\sqrt{5}\)</span>
        <span class="final-option">(D) \(5\sqrt{5}\)</span>
        <span class="final-option">(E) \(6\sqrt{5}\)</span>
        <span class="final-option">(N) Ne znam</span>
      </div>
    </div>
  </div>

  <!-- ČESTE GREŠKE -->
  <div class="card">
    <h2>Česte greške</h2>
    <div class="pitfall-item">
      <strong>Zaboravljeno množenje sa 2:</strong> Ako izračunaš samo \(\sqrt{r^2 - d^2} = 2\sqrt{5}\), to je samo <em>polovina</em> tetive. Puna dužina je \(2 \cdot 2\sqrt{5} = 4\sqrt{5}\).
    </div>
    <div class="pitfall-item">
      <strong>Greška pri dopunjavanju do potpunog kvadrata:</strong> Kod \(x^2 + 4x\) dodajemo \(+4\), a ne \(+2\). Pravilo: dopuna je \(\left(\frac{4}{2}\right)^2 = 4\). Ne zaboravi da istu vrednost dodaš i na desnu stranu jednačine!
    </div>
    <div class="pitfall-item">
      <strong>Pogrešan predznak centra:</strong> Iz \((x+2)^2\) sledi da je \(a = -2\), a ne \(+2\). Kanonski oblik je \((x - a)^2\), pa \(x + 2 = x - (-2)\).
    </div>
  </div>

  <!-- DODATNI IZAZOV -->
  <div class="card">
    <h2>Dodatni izazov</h2>
    <div class="challenge-box">
      <p><strong>Razmisli:</strong> Za isti krug \((x+2)^2 + (y-2)^2 = 25\), nađi dužinu tetive čija je sredina u tački \(Q(1,\, 5)\). Da li je tačka \(Q\) uopšte unutar kruga?</p>
      <p style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8;"><em>Savet: Prvo proveri da li je \(|CQ| < r\). Ako jeste, primeni istu formulu.</em></p>
    </div>
  </div>

</div>

<script>
(function() {
  // --- Collapsible toggle ---
  window.toggleCollapsible = function(btn) {
    var content = btn.nextElementSibling;
    var arrow = btn.querySelector('.arrow');
    if (content.classList.contains('open')) {
      content.classList.remove('open');
      arrow.innerHTML = '&#9660;';
    } else {
      content.classList.add('open');
      arrow.innerHTML = '&#9650;';
    }
  };

  // --- Checkpoint ---
  window.showAnswer = function(btn) {
    var ansDiv = btn.nextElementSibling;
    ansDiv.style.display = (ansDiv.style.display === 'block') ? 'none' : 'block';
  };

  // --- Canvas Geometry ---
  var canvas = document.getElementById('geoCanvas');
  var ctx = canvas.getContext('2d');

  // Circle: center C(-2, 2), radius 5
  var Cx = -2, Cy = 2, R = 5;

  // Default midpoint P(0, 3)
  var Px = 0, Py = 3;
  var defaultPx = 0, defaultPy = 3;

  // Canvas mapping: math -> pixel
  // We want C(-2,2) roughly centered. Let's show x from -9 to 7, y from -5 to 9
  var xMin = -9, xMax = 7, yMin = -5, yMax = 9;
  var canvasW, canvasH, scale, offsetX, offsetY;

  var dragging = false;
  var mode = 'drag';

  function recalcScale() {
    canvasW = canvas.width;
    canvasH = canvas.height;
    var sx = canvasW / (xMax - xMin);
    var sy = canvasH / (yMax - yMin);
    scale = Math.min(sx, sy);
    offsetX = canvasW / 2 - ((xMin + xMax) / 2) * scale;
    offsetY = canvasH / 2 + ((yMin + yMax) / 2) * scale;
  }

  function toPixelX(mx) { return offsetX + mx * scale; }
  function toPixelY(my) { return offsetY - my * scale; }
  function toMathX(px) { return (px - offsetX) / scale; }
  function toMathY(py) { return (offsetY - py) / scale; }

  function computeChord() {
    // d = distance from C to P
    var dx = Px - Cx, dy = Py - Cy;
    var d2 = dx * dx + dy * dy;
    var d = Math.sqrt(d2);

    if (d >= R) {
      return null; // P outside circle
    }

    // half-chord = sqrt(r^2 - d^2)
    var halfChord = Math.sqrt(R * R - d2);

    // direction of chord (perpendicular to CP)
    if (d < 0.001) {
      // P at center: any direction
      return { A: { x: Px + halfChord, y: Py }, B: { x: Px - halfChord, y: Py }, len: 2 * halfChord, d: d };
    }

    // unit vector CP
    var ux = dx / d, uy = dy / d;
    // perpendicular
    var vx = -uy, vy = ux;

    return {
      A: { x: Px + vx * halfChord, y: Py + vy * halfChord },
      B: { x: Px - vx * halfChord, y: Py - vy * halfChord },
      len: 2 * halfChord,
      d: d
    };
  }

  function drawGrid() {
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 1;
    for (var x = Math.ceil(xMin); x <= Math.floor(xMax); x++) {
      ctx.beginPath();
      ctx.moveTo(toPixelX(x), 0);
      ctx.lineTo(toPixelX(x), canvasH);
      ctx.stroke();
    }
    for (var y = Math.ceil(yMin); y <= Math.floor(yMax); y++) {
      ctx.beginPath();
      ctx.moveTo(0, toPixelY(y));
      ctx.lineTo(canvasW, toPixelY(y));
      ctx.stroke();
    }
  }

  function drawAxes() {
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 2;
    // x-axis
    ctx.beginPath();
    ctx.moveTo(0, toPixelY(0));
    ctx.lineTo(canvasW, toPixelY(0));
    ctx.stroke();
    // y-axis
    ctx.beginPath();
    ctx.moveTo(toPixelX(0), 0);
    ctx.lineTo(toPixelX(0), canvasH);
    ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#64748b';
    ctx.font = '13px system-ui, sans-serif';
    ctx.textAlign = 'center';
    for (var x = Math.ceil(xMin); x <= Math.floor(xMax); x++) {
      if (x === 0) continue;
      ctx.fillText(x, toPixelX(x), toPixelY(0) + 16);
    }
    ctx.textAlign = 'right';
    for (var y = Math.ceil(yMin); y <= Math.floor(yMax); y++) {
      if (y === 0) continue;
      ctx.fillText(y, toPixelX(0) - 6, toPixelY(y) + 4);
    }
    // Origin
    ctx.textAlign = 'right';
    ctx.fillText('O', toPixelX(0) - 6, toPixelY(0) + 16);
    // Axis arrows
    ctx.fillStyle = '#64748b';
    ctx.textAlign = 'left';
    ctx.fillText('x', canvasW - 14, toPixelY(0) + 16);
    ctx.fillText('y', toPixelX(0) + 8, 16);
  }

  function drawCircle() {
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.arc(toPixelX(Cx), toPixelY(Cy), R * scale, 0, 2 * Math.PI);
    ctx.stroke();
  }

  function drawPoint(mx, my, color, label, labelDx, labelDy) {
    var px = toPixelX(mx), py = toPixelY(my);
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(px, py, 6, 0, 2 * Math.PI);
    ctx.fill();
    ctx.strokeStyle = '#0f172a';
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.fillStyle = color;
    ctx.font = 'bold 14px system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(label, px + (labelDx || 0), py + (labelDy || -14));
  }

  function drawDashedLine(x1, y1, x2, y2, color, lineWidth) {
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth || 2;
    ctx.setLineDash([6, 4]);
    ctx.beginPath();
    ctx.moveTo(toPixelX(x1), toPixelY(y1));
    ctx.lineTo(toPixelX(x2), toPixelY(y2));
    ctx.stroke();
    ctx.setLineDash([]);
  }

  function drawSolidLine(x1, y1, x2, y2, color, lineWidth) {
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth || 2;
    ctx.beginPath();
    ctx.moveTo(toPixelX(x1), toPixelY(y1));
    ctx.lineTo(toPixelX(x2), toPixelY(y2));
    ctx.stroke();
  }

  function drawRightAngle(px, py, dir1x, dir1y, dir2x, dir2y, size) {
    var s = size / scale;
    var ax = px + dir1x * s, ay = py + dir1y * s;
    var bx = px + dir1x * s + dir2x * s, by = py + dir1y * s + dir2y * s;
    var cx = px + dir2x * s, cy = py + dir2y * s;
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(toPixelX(ax), toPixelY(ay));
    ctx.lineTo(toPixelX(bx), toPixelY(by));
    ctx.lineTo(toPixelX(cx), toPixelY(cy));
    ctx.stroke();
  }

  function draw() {
    recalcScale();
    ctx.clearRect(0, 0, canvasW, canvasH);

    drawGrid();
    drawAxes();
    drawCircle();

    var chord = computeChord();

    if (chord) {
      // Draw chord (thick, green)
      drawSolidLine(chord.A.x, chord.A.y, chord.B.x, chord.B.y, '#4ade80', 3);

      // Draw CP dashed
      drawDashedLine(Cx, Cy, Px, Py, '#f472b6', 2);

      // Draw radius CA and CB
      drawDashedLine(Cx, Cy, chord.A.x, chord.A.y, '#94a3b8', 1.5);
      drawDashedLine(Cx, Cy, chord.B.x, chord.B.y, '#94a3b8', 1.5);

      // Right angle at P
      var dx = Px - Cx, dy = Py - Cy;
      var d = chord.d;
      if (d > 0.1) {
        var ux = dx / d, uy = dy / d;
        var vx = -uy, vy = ux;
        drawRightAngle(Px, Py, ux, uy, vx, vy, 12);
      }

      // Chord endpoints
      drawPoint(chord.A.x, chord.A.y, '#4ade80', 'A', 14, -10);
      drawPoint(chord.B.x, chord.B.y, '#4ade80', 'B', -14, -10);

      // Labels for distances
      // d label
      var midDx = (Cx + Px) / 2, midDy = (Cy + Py) / 2;
      ctx.fillStyle = '#f472b6';
      ctx.font = 'bold 13px system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('d = ' + chord.d.toFixed(2), toPixelX(midDx) - 20, toPixelY(midDy) - 8);

      // r label on one radius
      var midRx = (Cx + chord.A.x) / 2, midRy = (Cy + chord.A.y) / 2;
      ctx.fillStyle = '#94a3b8';
      ctx.fillText('r = 5', toPixelX(midRx) + 16, toPixelY(midRy) - 6);

      // Chord length label
      ctx.fillStyle = '#4ade80';
      ctx.font = 'bold 14px system-ui, sans-serif';
      var midChordX = (chord.A.x + chord.B.x) / 2;
      var midChordY = (chord.A.y + chord.B.y) / 2;
      ctx.fillText('L = ' + chord.len.toFixed(2), toPixelX(midChordX), toPixelY(midChordY) + 22);

      // Update info
      document.getElementById('canvasInfo').innerHTML =
        'Sredina tetive P(' + Px.toFixed(1) + ', ' + Py.toFixed(1) + ') | ' +
        'd = ' + chord.d.toFixed(3) + ' | ' +
        'Dužina tetive L = ' + chord.len.toFixed(3);
    } else {
      document.getElementById('canvasInfo').innerHTML =
        'Tačka P je van kruga — tetiva ne postoji!';
    }

    // Center
    drawPoint(Cx, Cy, '#f472b6', 'C(−2, 2)', 0, 18);

    // Midpoint P
    drawPoint(Px, Py, '#fbbf24', 'P(' + Px.toFixed(1) + ', ' + Py.toFixed(1) + ')', 0, -14);
  }

  // --- Interaction ---
  function getPointerMath(e) {
    var rect = canvas.getBoundingClientRect();
    var scaleRatio = canvas.width / rect.width;
    var px, py;
    if (e.touches) {
      px = (e.touches[0].clientX - rect.left) * scaleRatio;
      py = (e.touches[0].clientY - rect.top) * scaleRatio;
    } else {
      px = (e.clientX - rect.left) * scaleRatio;
      py = (e.clientY - rect.top) * scaleRatio;
    }
    return { x: toMathX(px), y: toMathY(py) };
  }

  function isNearP(mx, my) {
    var dx = mx - Px, dy = my - Py;
    return Math.sqrt(dx * dx + dy * dy) < 0.6;
  }

  function constrainP(mx, my) {
    // Constrain P to be inside the circle (d < r)
    var dx = mx - Cx, dy = my - Cy;
    var dist = Math.sqrt(dx * dx + dy * dy);
    if (dist >= R - 0.05) {
      var factor = (R - 0.05) / dist;
      mx = Cx + dx * factor;
      my = Cy + dy * factor;
    }
    return { x: mx, y: my };
  }

  function onDown(e) {
    e.preventDefault();
    if (mode !== 'drag') return;
    var m = getPointerMath(e);
    if (isNearP(m.x, m.y)) {
      dragging = true;
    }
  }

  function onMove(e) {
    e.preventDefault();
    if (!dragging) return;
    var m = getPointerMath(e);
    var constrained = constrainP(m.x, m.y);
    Px = constrained.x;
    Py = constrained.y;
    draw();
  }

  function onUp(e) {
    dragging = false;
  }

  canvas.addEventListener('mousedown', onDown);
  canvas.addEventListener('mousemove', onMove);
  canvas.addEventListener('mouseup', onUp);
  canvas.addEventListener('mouseleave', onUp);
  canvas.addEventListener('touchstart', onDown, { passive: false });
  canvas.addEventListener('touchmove', onMove, { passive: false });
  canvas.addEventListener('touchend', onUp);

  window.setMode = function(m) {
    mode = m;
    document.getElementById('btnDrag').classList.toggle('active', m === 'drag');
  };

  window.resetCanvas = function() {
    Px = defaultPx;
    Py = defaultPy;
    draw();
  };

  // --- Responsive resize ---
  function handleResize() {
    var container = canvas.parentElement;
    var w = container.clientWidth - 48;
    if (w < 300) w = 300;
    if (w > 600) w = 600;
    var h = Math.round(w * 0.87);
    canvas.width = w;
    canvas.height = h;
    draw();
  }

  window.addEventListener('resize', handleResize);
  handleResize();
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{"title":"Dužina tetive kruga čija je sredina u datoj tački","subject":"math","unit":"geometry","topic_tags":["analitička geometrija","krug","tetiva","Pitagorina teorema","dopunjavanje do potpunog kvadrata"]}
BRAINSPARK_META-->