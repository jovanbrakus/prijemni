<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kompozicija funkcije f(f(x))</title>
<script type="text/info" id="logic-scratchpad">
Problem: Ako je f((1 − x)/(1 + x)) = x, gde je x ∈ R\{−1, 0, 1}, tada je f(f(x)) jednako?

Korak 1: Naći eksplicitni oblik funkcije f(x)
Dato je: f((1 − x)/(1 + x)) = x
Uvedimo smenu: t = (1 − x)/(1 + x)
Rešavamo za x u zavisnosti od t:
  t(1 + x) = 1 − x
  t + tx = 1 − x
  tx + x = 1 − t
  x(t + 1) = 1 − t
  x = (1 − t)/(1 + t)

Dakle: f(t) = (1 − t)/(1 + t)
Odnosno: f(x) = (1 − x)/(1 + x)

Korak 2: Izračunati f(f(x))
f(f(x)) = f((1 − x)/(1 + x))

Ali znamo iz polaznog uslova da je f((1 − x)/(1 + x)) = x!

Dakle: f(f(x)) = x

Korak 3: Verifikacija direktnim računom
f(x) = (1 − x)/(1 + x)

f(f(x)) = f((1 − x)/(1 + x))
         = (1 − (1 − x)/(1 + x)) / (1 + (1 − x)/(1 + x))

Brojilac: 1 − (1 − x)/(1 + x) = ((1 + x) − (1 − x))/(1 + x) = (1 + x − 1 + x)/(1 + x) = 2x/(1 + x)
Imenilac: 1 + (1 − x)/(1 + x) = ((1 + x) + (1 − x))/(1 + x) = (1 + x + 1 − x)/(1 + x) = 2/(1 + x)

f(f(x)) = (2x/(1 + x)) / (2/(1 + x)) = 2x/(1 + x) · (1 + x)/2 = x

Potvrđeno: f(f(x)) = x

Odgovor: (A) x

Napomena: f je involucija — funkcija koja je sama sebi inverzna, tj. f(f(x)) = x.
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

h1 {
  font-size: 2.2rem;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  line-height: 1.3;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1rem;
  margin-bottom: 32px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

.card h2 {
  color: #60a5fa;
  font-size: 1.4rem;
  margin-bottom: 16px;
}

.card h3 {
  color: #e2e8f0;
  font-size: 1.15rem;
  margin-bottom: 10px;
}

.highlight {
  color: #f472b6;
  font-weight: 600;
}

.math-box {
  background: rgba(56,189,248,0.08);
  border: 1px solid rgba(56,189,248,0.15);
  border-radius: 8px;
  padding: 14px 18px;
  margin: 12px 0;
  font-family: 'Courier New', monospace;
  font-size: 1.05rem;
  overflow-x: auto;
}

.given-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 16px;
}

.given-item {
  background: rgba(96,165,250,0.08);
  border: 1px solid rgba(96,165,250,0.18);
  border-radius: 10px;
  padding: 12px 18px;
  min-width: 80px;
  text-align: center;
  transition: transform 0.2s, border-color 0.2s;
}

.given-item:hover {
  transform: translateY(-2px);
}

.given-item .label {
  color: #94a3b8;
  font-size: 0.85rem;
  margin-bottom: 4px;
}

.given-item .value {
  color: #e2e8f0;
  font-size: 1.1rem;
  font-weight: 600;
}

.answer-option {
  cursor: default;
}

/* Plan card */
.plan-card {
  border-left: 3px solid #a78bfa;
}

.plan-card h2 {
  color: #a78bfa;
}

/* Details/collapsible */
details {
  margin: 15px 0;
  background: rgba(167,139,250,0.06);
  border: 1px solid rgba(167,139,250,0.15);
  border-radius: 10px;
  padding: 14px 18px;
}

details summary {
  cursor: pointer;
  color: #a78bfa;
  font-weight: 600;
  font-size: 1.05rem;
  user-select: none;
}

details summary:hover {
  color: #c4b5fd;
}

details[open] summary {
  margin-bottom: 12px;
}

details ul {
  list-style: none;
  padding-left: 0;
}

details li {
  padding: 6px 0;
  border-bottom: 1px solid rgba(51,65,85,0.5);
  color: #e2e8f0;
}

details li:last-child {
  border-bottom: none;
}

/* Canvas card */
.canvas-card {
  text-align: center;
}

.canvas-card canvas {
  width: 100%;
  max-width: 700px;
  border-radius: 10px;
  border: 1px solid #334155;
  touch-action: none;
}

.canvas-hint {
  color: #64748b;
  font-size: 0.85rem;
  margin-top: 8px;
}

/* Steps */
.step {
  display: flex;
  gap: 16px;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 14px;
  border-left: 3px solid transparent;
  transition: border-color 0.2s, background 0.2s;
  cursor: pointer;
}

.step:hover, .step.active {
  border-left-color: #4ade80;
  background: rgba(74,222,128,0.04);
}

.step-badge {
  flex-shrink: 0;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  color: #fff;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.95rem;
}

.step-content {
  flex: 1;
}

.step-content p {
  color: #94a3b8;
  margin-top: 6px;
}

/* Checkpoint */
.checkpoint {
  background: rgba(52,211,153,0.06);
  border: 1px solid rgba(52,211,153,0.18);
}

.checkpoint summary {
  color: #34d399;
}

/* Key insight */
.insight-card {
  background: linear-gradient(135deg, rgba(96,165,250,0.1), rgba(167,139,250,0.1));
  border: 1px solid rgba(167,139,250,0.25);
}

.insight-card h2 {
  color: #a78bfa;
}

/* Final answer */
.final-answer {
  border: 2px solid rgba(74,222,128,0.3);
  background: linear-gradient(135deg, rgba(74,222,128,0.06), rgba(52,211,153,0.04));
}

.final-answer h2 {
  color: #4ade80;
}

.answer-big {
  font-size: 1.6rem;
  font-weight: 700;
  color: #4ade80;
  text-align: center;
  margin: 20px 0;
}

.options-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  margin: 16px 0;
}

.option-box {
  padding: 10px 20px;
  border-radius: 10px;
  border: 2px solid #334155;
  background: #1e293b;
  text-align: center;
  min-width: 90px;
  transition: transform 0.2s;
}

.option-box.correct {
  border-color: #4ade80;
  background: rgba(74,222,128,0.1);
  transform: scale(1.05);
}

.option-box .opt-label {
  color: #94a3b8;
  font-size: 0.85rem;
}

.option-box .opt-value {
  font-size: 1.15rem;
  font-weight: 600;
  color: #e2e8f0;
}

.option-box.correct .opt-value {
  color: #4ade80;
}

.verification {
  color: #94a3b8;
  font-size: 0.95rem;
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid #334155;
}

/* Pitfalls */
.pitfall-list {
  list-style: none;
  padding: 0;
}

.pitfall-list li {
  padding: 10px 14px;
  margin-bottom: 8px;
  background: rgba(224,148,104,0.06);
  border-left: 3px solid #e09468;
  border-radius: 0 8px 8px 0;
  color: #e2e8f0;
}

.pitfall-list li strong {
  color: #e09468;
}

/* Challenge */
.challenge-card {
  border: 1px solid rgba(244,114,182,0.2);
  background: rgba(244,114,182,0.04);
}

.challenge-card h2 {
  color: #f472b6;
}

@media (max-width: 700px) {
  h1 { font-size: 1.6rem; }
  .card { padding: 16px; }
  .step { flex-direction: column; gap: 10px; }
  .given-grid { flex-direction: column; }
  .options-row { flex-direction: column; align-items: center; }
}
</style>
</head>
<body>
<div class="container">

  <h1>Kompozicija funkcije f(f(x))</h1>
  <p class="subtitle">Funkcionalne jednačine, smena promenljive i involucija</p>

  <!-- Problem Statement -->
  <div class="card problem-statement">
    <h2>Postavka zadatka</h2>
    <p>Ako je \(f\!\left(\dfrac{1 - x}{1 + x}\right) = x\), gde je \(x \in \mathbb{R} \setminus \{-1,\, 0,\, 1\}\), tada je \(f(f(x))\) jednako:</p>

    <div class="given-grid" style="margin-bottom: 18px;">
      <div class="given-item">
        <div class="label">Uslov</div>
        <div class="value">\(f\!\left(\frac{1-x}{1+x}\right) = x\)</div>
      </div>
      <div class="given-item">
        <div class="label">Domen</div>
        <div class="value">\(x \in \mathbb{R} \setminus \{-1, 0, 1\}\)</div>
      </div>
      <div class="given-item">
        <div class="label">Traži se</div>
        <div class="value">\(f(f(x))\)</div>
      </div>
    </div>

    <div class="given-grid">
      <div class="given-item answer-option" data-option="A">
        <div class="label">(A)</div>
        <div class="value">\(x\)</div>
      </div>
      <div class="given-item answer-option" data-option="B">
        <div class="label">(B)</div>
        <div class="value">\(\dfrac{1-x}{1+x}\)</div>
      </div>
      <div class="given-item answer-option" data-option="C">
        <div class="label">(C)</div>
        <div class="value">\(\dfrac{1}{x}\)</div>
      </div>
      <div class="given-item answer-option" data-option="D">
        <div class="label">(D)</div>
        <div class="value">\(\dfrac{1+x}{1-x}\)</div>
      </div>
      <div class="given-item answer-option" data-option="E">
        <div class="label">(E)</div>
        <div class="value">\(2x\)</div>
      </div>
    </div>
  </div>

  <!-- Plan -->
  <div class="card plan-card">
    <h2>Plan rešavanja</h2>
    <p>Iz datog uslova \(f\!\left(\frac{1-x}{1+x}\right) = x\) naći ćemo eksplicitni oblik funkcije \(f\) uvođenjem smene, a zatim izračunati \(f(f(x))\) direktnim uvrštavanjem.</p>
  </div>

  <!-- Theory Refresher -->
  <details>
    <summary>Ključne formule i pojmovi</summary>
    <ul>
      <li><strong>Funkcionalna jednačina:</strong> Iz jednačine oblika \(f(g(x)) = x\) zaključujemo da je \(f\) inverzna funkcija funkciji \(g\), tj. \(f = g^{-1}\).</li>
      <li><strong>Smena promenljive:</strong> Ako je \(t = g(x)\), rešavamo \(x = g^{-1}(t)\) da bismo dobili \(f(t) = g^{-1}(t)\).</li>
      <li><strong>Involucija:</strong> Funkcija \(f\) je involucija ako važi \(f(f(x)) = x\) za sve \(x\) iz domena. Geometrijski, njen graf je simetričan u odnosu na pravu \(y = x\).</li>
      <li><strong>Mebijusova transformacija:</strong> \(f(x) = \frac{ax + b}{cx + d}\) — razlomljena linearna funkcija. Kompozicija se računa kao množenje odgovarajućih matrica.</li>
    </ul>
  </details>

  <!-- Canvas Visualization -->
  <div class="card canvas-card">
    <h2>Grafički prikaz</h2>
    <p style="color:#94a3b8; margin-bottom: 14px;">Grafik funkcije \(f(x) = \frac{1-x}{1+x}\) i prava \(y = x\) — simetrija involucije</p>
    <canvas id="graph-canvas" width="700" height="500"></canvas>
    <p class="canvas-hint">Prevlačite tačku da vidite kako se \(f(x)\) i \(f(f(x))\) menjaju</p>
  </div>

  <!-- Step-by-step solution -->
  <div class="card">
    <h2>Rešenje korak po korak</h2>

    <div class="step" id="step-1">
      <div class="step-badge">1</div>
      <div class="step-content">
        <h3>Uvedimo smenu za argument funkcije</h3>
        <p>Dato je da važi:</p>
        <div class="math-box">
          \[ f\!\left(\frac{1 - x}{1 + x}\right) = x \]
        </div>
        <p>Uvedimo smenu \(t = \dfrac{1 - x}{1 + x}\). Cilj nam je da izrazimo \(x\) preko \(t\), jer ćemo tada znati šta je \(f(t)\).</p>
      </div>
    </div>

    <div class="step" id="step-2">
      <div class="step-badge">2</div>
      <div class="step-content">
        <h3>Rešimo jednačinu po \(x\)</h3>
        <p>Iz \(t = \dfrac{1-x}{1+x}\) množimo obe strane sa \((1+x)\):</p>
        <div class="math-box">
          \[ t(1+x) = 1 - x \]
        </div>
        <p>Raspisujemo levu stranu:</p>
        <div class="math-box">
          \[ t + tx = 1 - x \]
        </div>
        <p>Prebacimo članove sa \(x\) na jednu stranu:</p>
        <div class="math-box">
          \[ tx + x = 1 - t \]
        </div>
        <p>Izvučemo \(x\) ispred zagrade:</p>
        <div class="math-box">
          \[ x(t + 1) = 1 - t \]
        </div>
        <p>Delimo sa \((t+1)\), što je dozvoljeno jer \(t \neq -1\):</p>
        <div class="math-box">
          \[ x = \frac{1 - t}{1 + t} \]
        </div>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Ako je \(t = \frac{1-x}{1+x}\), šta je \(x\) izraženo preko \(t\)?</summary>
      <p>\(x = \dfrac{1-t}{1+t}\). Primetite da je formula za \(x\) preko \(t\) identičnog oblika kao formula za \(t\) preko \(x\)!</p>
    </details>

    <div class="step" id="step-3">
      <div class="step-badge">3</div>
      <div class="step-content">
        <h3>Zapišimo eksplicitni oblik \(f\)</h3>
        <p>Pošto je \(f(t) = x\), a upravo smo dobili \(x = \dfrac{1-t}{1+t}\), sledi:</p>
        <div class="math-box">
          \[ f(t) = \frac{1 - t}{1 + t} \]
        </div>
        <p>Odnosno, zamenimo \(t\) sa \(x\) (jer je to samo naziv promenljive):</p>
        <div class="math-box">
          \[ \boxed{f(x) = \frac{1 - x}{1 + x}} \]
        </div>
      </div>
    </div>

    <div class="step" id="step-4">
      <div class="step-badge">4</div>
      <div class="step-content">
        <h3>Izračunajmo \(f(f(x))\) — prvi način (direktno iz uslova)</h3>
        <p>Sada znamo da je \(f(x) = \dfrac{1-x}{1+x}\). Izračunajmo:</p>
        <div class="math-box">
          \[ f(f(x)) = f\!\left(\frac{1-x}{1+x}\right) \]
        </div>
        <p>Ali čekajte — pogledajmo ponovo polazni uslov zadatka:</p>
        <div class="math-box">
          \[ f\!\left(\frac{1-x}{1+x}\right) = x \]
        </div>
        <p>To je upravo ono što nam treba! Dakle, odmah sledi:</p>
        <div class="math-box">
          \[ f(f(x)) = x \]
        </div>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Zašto iz \(f\!\left(\frac{1-x}{1+x}\right) = x\) i \(f(x) = \frac{1-x}{1+x}\) sledi \(f(f(x)) = x\)?</summary>
      <p>Jer \(f(f(x)) = f\!\left(\frac{1-x}{1+x}\right)\), a to je po datom uslovu jednako \(x\). U suštini, funkcija \(f\) je sama sebi inverzna.</p>
    </details>

    <div class="step" id="step-5">
      <div class="step-badge">5</div>
      <div class="step-content">
        <h3>Verifikacija — drugi način (direktnim računom)</h3>
        <p>Radi sigurnosti, izračunajmo \(f(f(x))\) i algebarski. Startujemo od:</p>
        <div class="math-box">
          \[ f(f(x)) = f\!\left(\frac{1-x}{1+x}\right) = \frac{1 - \dfrac{1-x}{1+x}}{1 + \dfrac{1-x}{1+x}} \]
        </div>
        <p>Računamo <strong>brojilac</strong> — svodimo na zajednički imenilac \((1+x)\):</p>
        <div class="math-box">
          \[ 1 - \frac{1-x}{1+x} = \frac{(1+x) - (1-x)}{1+x} = \frac{1+x-1+x}{1+x} = \frac{2x}{1+x} \]
        </div>
        <p>Računamo <strong>imenilac</strong> — svodimo na zajednički imenilac \((1+x)\):</p>
        <div class="math-box">
          \[ 1 + \frac{1-x}{1+x} = \frac{(1+x) + (1-x)}{1+x} = \frac{1+x+1-x}{1+x} = \frac{2}{1+x} \]
        </div>
        <p>Delimo brojilac sa imeniocem:</p>
        <div class="math-box">
          \[ f(f(x)) = \frac{\dfrac{2x}{1+x}}{\dfrac{2}{1+x}} = \frac{2x}{1+x} \cdot \frac{1+x}{2} = \frac{2x}{2} = x \]
        </div>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Za \(x = 2\), koliko je \(f(2)\) i \(f(f(2))\)?</summary>
      <p>\(f(2) = \dfrac{1-2}{1+2} = \dfrac{-1}{3} = -\dfrac{1}{3}\). Zatim: \(f\!\left(-\dfrac{1}{3}\right) = \dfrac{1-\left(-\frac{1}{3}\right)}{1+\left(-\frac{1}{3}\right)} = \dfrac{\frac{4}{3}}{\frac{2}{3}} = \dfrac{4}{2} = 2\). Potvrđeno: \(f(f(2)) = 2\).</p>
    </details>
  </div>

  <!-- Key Insight -->
  <div class="card insight-card">
    <h2>Ključni uvid</h2>
    <p>Funkcija \(f(x) = \dfrac{1-x}{1+x}\) je <span class="highlight">involucija</span> — funkcija koja je sama sebi inverzna. To znači da primena \(f\) dva puta vraća polaznu vrednost. Ovo se moglo uočiti odmah iz zadatka: uslov \(f\!\left(\frac{1-x}{1+x}\right) = x\) nam doslovno kaže da je \(f\) inverzna funkciji \(g(x) = \frac{1-x}{1+x}\), a pošto se ispostavlja da je \(f = g\), funkcija je inverzna sama sebi!</p>
    <div class="math-box" style="text-align: center; font-size: 1.2rem;">
      \[ f(f(x)) = x \quad \text{za svako } x \in \mathbb{R} \setminus \{-1, 0, 1\} \]
    </div>
  </div>

  <!-- Final Answer -->
  <div class="card final-answer">
    <h2>Konačan odgovor</h2>
    <div class="answer-big">\(f(f(x)) = x\)</div>

    <div class="options-row">
      <div class="option-box correct">
        <div class="opt-label">(A)</div>
        <div class="opt-value">\(x\)</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(B)</div>
        <div class="opt-value">\(\frac{1-x}{1+x}\)</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(C)</div>
        <div class="opt-value">\(\frac{1}{x}\)</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(D)</div>
        <div class="opt-value">\(\frac{1+x}{1-x}\)</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(E)</div>
        <div class="opt-value">\(2x\)</div>
      </div>
    </div>

    <p class="verification"><strong>Provera:</strong> Za \(x = 3\): \(f(3) = \frac{1-3}{1+3} = \frac{-2}{4} = -0{,}5\). Zatim \(f(-0{,}5) = \frac{1-(-0{,}5)}{1+(-0{,}5)} = \frac{1{,}5}{0{,}5} = 3 = x\). Tačno je \(f(f(x)) = x\). &check;</p>
  </div>

  <!-- Common Pitfalls -->
  <div class="card">
    <h2>Česte greške</h2>
    <ul class="pitfall-list">
      <li><strong>Preskakanje smene:</strong> Neki učenici pokušavaju da izračunaju \(f(f(x))\) bez prethodno nalaženja eksplicitnog oblika \(f(x)\). Bez poznavanja formule za \(f\), ne možemo pouzdano izračunati kompoziciju.</li>
      <li><strong>Brkanje \(f(x)\) sa argumentom:</strong> Uslov \(f\!\left(\frac{1-x}{1+x}\right) = x\) ne znači da je \(f(x) = x\). Ovde je \(\frac{1-x}{1+x}\) argument funkcije, ne sama funkcija. Potrebno je invertovati taj izraz da se dobije \(f\).</li>
    </ul>
  </div>

  <!-- Optional Challenge -->
  <div class="card challenge-card">
    <h2>Dodatni izazov</h2>
    <p>Neka je \(g(x) = \dfrac{2x + 1}{x - 3}\). Da li je \(g\) takođe involucija? Izračunajte \(g(g(x))\) i proverite.</p>
    <details>
      <summary>Pomoć</summary>
      <p>Izračunajte \(g(g(x))\) tako što ćete u formulu za \(g\) umesto \(x\) uvrstiti \(\frac{2x+1}{x-3}\). Svedite na zajednički imenilac brojilac i imenilac posebno. Ako dobijete \(x\), onda je \(g\) involucija.</p>
      <p>Odgovor: \(g(g(x)) = \dfrac{2 \cdot \frac{2x+1}{x-3} + 1}{\frac{2x+1}{x-3} - 3} = \dfrac{\frac{4x+2+x-3}{x-3}}{\frac{2x+1-3x+9}{x-3}} = \dfrac{5x - 1}{-x + 10}\). Ovo nije \(x\), pa \(g\) <strong>nije</strong> involucija.</p>
    </details>
  </div>

</div>

<script>
(() => {
  const canvas = document.getElementById('graph-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.width;
  const H = canvas.height;

  // f(x) = (1-x)/(1+x)
  function f(x) {
    if (Math.abs(1 + x) < 0.001) return NaN;
    return (1 - x) / (1 + x);
  }

  // Coordinate system
  const xMin = -4, xMax = 5;
  const yMin = -4, yMax = 5;

  function toCanvasX(x) {
    return ((x - xMin) / (xMax - xMin)) * W;
  }
  function toCanvasY(y) {
    return H - ((y - yMin) / (yMax - yMin)) * H;
  }
  function fromCanvasX(cx) {
    return xMin + (cx / W) * (xMax - xMin);
  }
  function fromCanvasY(cy) {
    return yMin + ((H - cy) / H) * (yMax - yMin);
  }

  // Draggable point
  let dragX = 2;
  let isDragging = false;

  function draw() {
    // Background
    ctx.fillStyle = '#0c1222';
    ctx.fillRect(0, 0, W, H);

    // Grid lines
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 1;
    for (let x = Math.ceil(xMin); x <= xMax; x++) {
      ctx.beginPath();
      ctx.moveTo(toCanvasX(x), 0);
      ctx.lineTo(toCanvasX(x), H);
      ctx.stroke();
    }
    for (let y = Math.ceil(yMin); y <= yMax; y++) {
      ctx.beginPath();
      ctx.moveTo(0, toCanvasY(y));
      ctx.lineTo(W, toCanvasY(y));
      ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, toCanvasY(0));
    ctx.lineTo(W, toCanvasY(0));
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(toCanvasX(0), 0);
    ctx.lineTo(toCanvasX(0), H);
    ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#64748b';
    ctx.font = '12px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    for (let x = Math.ceil(xMin); x <= xMax; x++) {
      if (x === 0) continue;
      ctx.fillText(String(x), toCanvasX(x), toCanvasY(0) + 16);
    }
    ctx.textAlign = 'right';
    for (let y = Math.ceil(yMin); y <= yMax; y++) {
      if (y === 0) continue;
      ctx.fillText(String(y), toCanvasX(0) - 8, toCanvasY(y) + 4);
    }

    // Label axes
    ctx.fillStyle = '#64748b';
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('x', W - 20, toCanvasY(0) - 8);
    ctx.textAlign = 'center';
    ctx.fillText('y', toCanvasX(0) + 14, 18);

    // Draw y = x line (dashed)
    ctx.setLineDash([8, 6]);
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(toCanvasX(xMin), toCanvasY(xMin));
    ctx.lineTo(toCanvasX(xMax), toCanvasY(xMax));
    ctx.stroke();
    ctx.setLineDash([]);

    // Label y = x
    ctx.fillStyle = '#64748b';
    ctx.font = '13px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('y = x', toCanvasX(3.5) + 6, toCanvasY(3.5) - 6);

    // Draw vertical asymptote x = -1
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(toCanvasX(-1), 0);
    ctx.lineTo(toCanvasX(-1), H);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#ef4444';
    ctx.font = '11px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('x = \u22121', toCanvasX(-1) + 4, 16);

    // Draw horizontal asymptote y = -1
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, toCanvasY(-1));
    ctx.lineTo(W, toCanvasY(-1));
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#ef4444';
    ctx.font = '11px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('y = \u22121', W - 55, toCanvasY(-1) - 6);

    // Draw f(x) = (1-x)/(1+x) as curve
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 3;
    ctx.beginPath();
    let started = false;
    for (let px = 0; px <= W; px++) {
      const x = fromCanvasX(px);
      const y = f(x);
      if (isNaN(y) || Math.abs(y) > 50) {
        started = false;
        continue;
      }
      const cy = toCanvasY(y);
      if (cy < -100 || cy > H + 100) {
        started = false;
        continue;
      }
      if (!started) {
        ctx.moveTo(px, cy);
        started = true;
      } else {
        ctx.lineTo(px, cy);
      }
    }
    ctx.stroke();

    // Function label
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('f(x) = (1\u2212x)/(1+x)', toCanvasX(1.5), toCanvasY(f(1.5)) - 16);

    // Interactive point
    const yVal = f(dragX);
    if (!isNaN(yVal) && Math.abs(yVal) < 50) {
      const ffVal = f(yVal);

      // Dashed line: x -> f(x)
      ctx.setLineDash([5, 4]);
      ctx.strokeStyle = '#4ade80';
      ctx.lineWidth = 1.5;
      // Vertical from (dragX, 0) to (dragX, f(dragX))
      ctx.beginPath();
      ctx.moveTo(toCanvasX(dragX), toCanvasY(0));
      ctx.lineTo(toCanvasX(dragX), toCanvasY(yVal));
      ctx.stroke();
      // Horizontal from (dragX, f(dragX)) to (0, f(dragX))
      ctx.beginPath();
      ctx.moveTo(toCanvasX(dragX), toCanvasY(yVal));
      ctx.lineTo(toCanvasX(0), toCanvasY(yVal));
      ctx.stroke();

      // If f(f(x)) is valid, show the second application
      if (!isNaN(ffVal) && Math.abs(ffVal) < 50) {
        ctx.strokeStyle = '#f472b6';
        // Horizontal from (0, yVal) to (yVal, yVal) — going to use yVal as new x
        ctx.beginPath();
        ctx.moveTo(toCanvasX(yVal), toCanvasY(yVal));
        ctx.lineTo(toCanvasX(yVal), toCanvasY(ffVal));
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(toCanvasX(yVal), toCanvasY(ffVal));
        ctx.lineTo(toCanvasX(0), toCanvasY(ffVal));
        ctx.stroke();
        ctx.setLineDash([]);

        // Point for f(yVal) = f(f(x))
        ctx.fillStyle = '#f472b6';
        ctx.beginPath();
        ctx.arc(toCanvasX(yVal), toCanvasY(ffVal), 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#0c1222';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Label f(f(x))
        ctx.fillStyle = '#f472b6';
        ctx.font = 'bold 13px Segoe UI, system-ui, sans-serif';
        ctx.textAlign = 'left';
        const ffLabel = 'f(f(x)) = ' + ffVal.toFixed(2).replace('.', ',');
        ctx.fillText(ffLabel, toCanvasX(yVal) + 12, toCanvasY(ffVal) - 10);
      }
      ctx.setLineDash([]);

      // Point for f(x)
      ctx.fillStyle = '#4ade80';
      ctx.beginPath();
      ctx.arc(toCanvasX(dragX), toCanvasY(yVal), 7, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#0c1222';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Label for the point
      ctx.fillStyle = '#4ade80';
      ctx.font = 'bold 13px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'left';
      const xLabel = 'x = ' + dragX.toFixed(2).replace('.', ',');
      const fLabel = 'f(x) = ' + yVal.toFixed(2).replace('.', ',');
      ctx.fillText(xLabel, toCanvasX(dragX) + 12, toCanvasY(yVal) + 4);
      ctx.fillText(fLabel, toCanvasX(dragX) + 12, toCanvasY(yVal) + 20);
    }

    // Draggable point indicator on x-axis
    ctx.fillStyle = '#4ade80';
    ctx.beginPath();
    ctx.arc(toCanvasX(dragX), toCanvasY(0), 8, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#0c1222';
    ctx.lineWidth = 2;
    ctx.stroke();

    // Legend
    ctx.fillStyle = '#1e293b';
    ctx.fillRect(W - 230, H - 80, 220, 70);
    ctx.strokeStyle = '#334155';
    ctx.lineWidth = 1;
    ctx.strokeRect(W - 230, H - 80, 220, 70);

    ctx.font = '12px Segoe UI, system-ui, sans-serif';
    // f(x) legend
    ctx.fillStyle = '#60a5fa';
    ctx.fillRect(W - 218, H - 66, 14, 3);
    ctx.fillStyle = '#e2e8f0';
    ctx.textAlign = 'left';
    ctx.fillText('f(x) = (1\u2212x)/(1+x)', W - 198, H - 60);
    // f(x) point
    ctx.fillStyle = '#4ade80';
    ctx.beginPath();
    ctx.arc(W - 211, H - 44, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#e2e8f0';
    ctx.fillText('(x, f(x))', W - 198, H - 40);
    // f(f(x)) point
    ctx.fillStyle = '#f472b6';
    ctx.beginPath();
    ctx.arc(W - 211, H - 24, 5, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#e2e8f0';
    ctx.fillText('(f(x), f(f(x))) = (f(x), x)', W - 198, H - 20);
  }

  draw();

  // Mouse interaction
  function getMouseX(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = W / rect.width;
    return (e.clientX - rect.left) * scaleX;
  }

  function getTouchX(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = W / rect.width;
    return (e.touches[0].clientX - rect.left) * scaleX;
  }

  function startDrag(canvasX) {
    const mx = fromCanvasX(canvasX);
    if (Math.abs(mx - dragX) < 0.3) {
      isDragging = true;
    }
  }

  function moveDrag(canvasX) {
    if (!isDragging) return;
    let mx = fromCanvasX(canvasX);
    // Clamp and avoid asymptote
    mx = Math.max(xMin + 0.2, Math.min(xMax - 0.2, mx));
    if (Math.abs(mx + 1) < 0.15) mx = mx > -1 ? -0.85 : -1.15;
    if (Math.abs(mx) < 0.1) mx = mx >= 0 ? 0.1 : -0.1;
    if (Math.abs(mx - 1) < 0.1) mx = mx > 1 ? 1.1 : 0.9;
    dragX = mx;
    draw();
  }

  function endDrag() {
    isDragging = false;
  }

  canvas.addEventListener('mousedown', function(e) { startDrag(getMouseX(e)); });
  canvas.addEventListener('mousemove', function(e) { moveDrag(getMouseX(e)); });
  canvas.addEventListener('mouseup', endDrag);
  canvas.addEventListener('mouseleave', endDrag);

  canvas.addEventListener('touchstart', function(e) {
    e.preventDefault();
    startDrag(getTouchX(e));
  });
  canvas.addEventListener('touchmove', function(e) {
    e.preventDefault();
    moveDrag(getTouchX(e));
  });
  canvas.addEventListener('touchend', endDrag);

  // Step click interactivity
  const steps = document.querySelectorAll('.step');
  steps.forEach(function(step) {
    step.addEventListener('click', function() {
      steps.forEach(function(s) { s.classList.remove('active'); });
      step.classList.add('active');
    });
  });
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{
  "title": "Kompozicija funkcije f(f(x)) — involucija",
  "subject": "math",
  "unit": "algebra",
  "topic_tags": ["funkcionalne jednačine", "kompozicija funkcija", "involucija", "smena promenljive", "razlomljene linearne funkcije"]
}
BRAINSPARK_META-->