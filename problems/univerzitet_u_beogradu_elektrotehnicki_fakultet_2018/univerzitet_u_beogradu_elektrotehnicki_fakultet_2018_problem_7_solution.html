<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apolonijeva kruznica - geometrijsko mesto tacaka</title>
<script type="text/info" id="logic-scratchpad">
Problem: Skup tacaka P(x,y) u ravni xOy za koje je rastojanje do tacke A(1,0)
dva puta vece od rastojanja do tacke B(-2,0) predstavlja koju krivu?

Korak 1: Postavimo uslov
  |PA| = 2·|PB|
  gde je P(x,y), A(1,0), B(-2,0)

Korak 2: Izracunajmo rastojanja
  |PA| = sqrt((x-1)² + y²)
  |PB| = sqrt((x+2)² + y²)

Korak 3: Kvadrirajmo obe strane jednacine |PA| = 2·|PB|
  (x-1)² + y² = 4·((x+2)² + y²)

Korak 4: Raspisemo
  x² - 2x + 1 + y² = 4·(x² + 4x + 4 + y²)
  x² - 2x + 1 + y² = 4x² + 16x + 16 + 4y²

Korak 5: Prenesemo sve na jednu stranu
  x² - 2x + 1 + y² - 4x² - 16x - 16 - 4y² = 0
  -3x² - 18x - 15 - 3y² = 0

Korak 6: Podelimo sa (-3)
  x² + 6x + 5 + y² = 0

Korak 7: Dopunimo do potpunog kvadrata po x
  (x² + 6x + 9) + y² = 9 - 5
  (x + 3)² + y² = 4

Korak 8: Prepoznajemo jednacinu kruznice
  Centar: C(-3, 0), poluprecnik: r = 2

Ovo je Apolonijeva kruznica za tacke A(1,0) i B(-2,0) sa odnosom k = 2.

Odgovor: (B) kruznica
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

h1 {
  font-size: 2.2rem;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  line-height: 1.3;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1rem;
  margin-bottom: 32px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

.card h2 {
  color: #60a5fa;
  font-size: 1.4rem;
  margin-bottom: 16px;
}

.card h3 {
  color: #e2e8f0;
  font-size: 1.15rem;
  margin-bottom: 10px;
}

.highlight {
  color: #f472b6;
  font-weight: 600;
}

.math-box {
  background: rgba(56,189,248,0.08);
  border: 1px solid rgba(56,189,248,0.15);
  border-radius: 8px;
  padding: 14px 18px;
  margin: 12px 0;
  font-family: 'Courier New', monospace;
  font-size: 1.05rem;
  overflow-x: auto;
}

.given-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 16px;
}

.given-item {
  background: rgba(96,165,250,0.08);
  border: 1px solid rgba(96,165,250,0.18);
  border-radius: 10px;
  padding: 12px 18px;
  min-width: 80px;
  text-align: center;
  transition: transform 0.2s, border-color 0.2s;
}

.given-item:hover {
  transform: translateY(-2px);
}

.given-item .label {
  color: #94a3b8;
  font-size: 0.85rem;
  margin-bottom: 4px;
}

.given-item .value {
  color: #e2e8f0;
  font-size: 1.1rem;
  font-weight: 600;
}

.answer-option {
  cursor: default;
}

/* Plan card */
.plan-card {
  border-left: 3px solid #a78bfa;
}

.plan-card h2 {
  color: #a78bfa;
}

/* Details/collapsible */
details {
  margin: 15px 0;
  background: rgba(167,139,250,0.06);
  border: 1px solid rgba(167,139,250,0.15);
  border-radius: 10px;
  padding: 14px 18px;
}

details summary {
  cursor: pointer;
  color: #a78bfa;
  font-weight: 600;
  font-size: 1.05rem;
  user-select: none;
}

details summary:hover {
  color: #c4b5fd;
}

details[open] summary {
  margin-bottom: 12px;
}

details ul {
  list-style: none;
  padding-left: 0;
}

details li {
  padding: 6px 0;
  border-bottom: 1px solid rgba(51,65,85,0.5);
  color: #e2e8f0;
}

details li:last-child {
  border-bottom: none;
}

/* Canvas card */
.canvas-card {
  text-align: center;
}

.canvas-card canvas {
  width: 100%;
  max-width: 700px;
  border-radius: 10px;
  border: 1px solid #334155;
  touch-action: none;
}

.canvas-hint {
  color: #64748b;
  font-size: 0.85rem;
  margin-top: 8px;
}

/* Steps */
.step {
  display: flex;
  gap: 16px;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 14px;
  border-left: 3px solid transparent;
  transition: border-color 0.2s, background 0.2s;
  cursor: pointer;
}

.step:hover, .step.active {
  border-left-color: #4ade80;
  background: rgba(74,222,128,0.04);
}

.step-badge {
  flex-shrink: 0;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  color: #fff;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.95rem;
}

.step-content {
  flex: 1;
}

.step-content p {
  color: #94a3b8;
  margin-top: 6px;
}

/* Checkpoint */
.checkpoint {
  background: rgba(52,211,153,0.06);
  border: 1px solid rgba(52,211,153,0.18);
}

.checkpoint summary {
  color: #34d399;
}

/* Key insight */
.insight-card {
  background: linear-gradient(135deg, rgba(96,165,250,0.1), rgba(167,139,250,0.1));
  border: 1px solid rgba(167,139,250,0.25);
}

.insight-card h2 {
  color: #a78bfa;
}

/* Final answer */
.final-answer {
  border: 2px solid rgba(74,222,128,0.3);
  background: linear-gradient(135deg, rgba(74,222,128,0.06), rgba(52,211,153,0.04));
}

.final-answer h2 {
  color: #4ade80;
}

.answer-big {
  font-size: 1.6rem;
  font-weight: 700;
  color: #4ade80;
  text-align: center;
  margin: 20px 0;
}

.options-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  margin: 16px 0;
}

.option-box {
  padding: 10px 20px;
  border-radius: 10px;
  border: 2px solid #334155;
  background: #1e293b;
  text-align: center;
  min-width: 120px;
  transition: transform 0.2s;
}

.option-box.correct {
  border-color: #4ade80;
  background: rgba(74,222,128,0.1);
  transform: scale(1.05);
}

.option-box .opt-label {
  color: #94a3b8;
  font-size: 0.85rem;
}

.option-box .opt-value {
  font-size: 1.15rem;
  font-weight: 600;
  color: #e2e8f0;
}

.option-box.correct .opt-value {
  color: #4ade80;
}

.verification {
  color: #94a3b8;
  font-size: 0.95rem;
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid #334155;
}

/* Pitfalls */
.pitfall-list {
  list-style: none;
  padding: 0;
}

.pitfall-list li {
  padding: 10px 14px;
  margin-bottom: 8px;
  background: rgba(224,148,104,0.06);
  border-left: 3px solid #e09468;
  border-radius: 0 8px 8px 0;
  color: #e2e8f0;
}

.pitfall-list li strong {
  color: #e09468;
}

/* Challenge */
.challenge-card {
  border: 1px solid rgba(244,114,182,0.2);
  background: rgba(244,114,182,0.04);
}

.challenge-card h2 {
  color: #f472b6;
}

/* Slider styling */
.slider-container {
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: center;
  margin-top: 14px;
  flex-wrap: wrap;
}

.slider-container label {
  color: #94a3b8;
  font-size: 0.95rem;
}

.slider-container input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 200px;
  height: 6px;
  border-radius: 3px;
  background: #334155;
  outline: none;
}

.slider-container input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #60a5fa;
  cursor: pointer;
  box-shadow: 0 0 8px rgba(96,165,250,0.5);
}

.slider-container input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #60a5fa;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 8px rgba(96,165,250,0.5);
}

.slider-value {
  color: #60a5fa;
  font-weight: 700;
  font-size: 1.1rem;
  min-width: 50px;
  text-align: center;
}

@media (max-width: 700px) {
  h1 { font-size: 1.6rem; }
  .card { padding: 16px; }
  .step { flex-direction: column; gap: 10px; }
  .given-grid { flex-direction: column; }
  .options-row { flex-direction: column; align-items: center; }
}
</style>
</head>
<body>
<div class="container">

  <h1>Apolonijeva kruznica</h1>
  <p class="subtitle">Geometrijsko mesto tacaka sa zadatim odnosom rastojanja do dve fiksne tacke</p>

  <!-- Problem Statement -->
  <div class="card problem-statement">
    <h2>Postavka zadatka</h2>
    <p>Skup tacaka u ravni \(xOy\) za koje je rastojanje do tacke \(A(1, 0)\) dva puta vece od rastojanja do tacke \(B(-2, 0)\) predstavlja:</p>

    <div class="given-grid">
      <div class="given-item">
        <div class="label">Tacka A</div>
        <div class="value">\(A(1,\; 0)\)</div>
      </div>
      <div class="given-item">
        <div class="label">Tacka B</div>
        <div class="value">\(B(-2,\; 0)\)</div>
      </div>
      <div class="given-item">
        <div class="label">Uslov</div>
        <div class="value">\(|PA| = 2\,|PB|\)</div>
      </div>
    </div>

    <div class="given-grid">
      <div class="given-item answer-option" data-option="A">
        <div class="label">(A)</div>
        <div class="value">pravu</div>
      </div>
      <div class="given-item answer-option" data-option="B">
        <div class="label">(B)</div>
        <div class="value">kruznicu</div>
      </div>
      <div class="given-item answer-option" data-option="C">
        <div class="label">(C)</div>
        <div class="value">elipsu</div>
      </div>
      <div class="given-item answer-option" data-option="D">
        <div class="label">(D)</div>
        <div class="value">parabolu</div>
      </div>
      <div class="given-item answer-option" data-option="E">
        <div class="label">(E)</div>
        <div class="value">hiperbolu</div>
      </div>
    </div>
  </div>

  <!-- Plan -->
  <div class="card plan-card">
    <h2>Plan resavanja</h2>
    <p>Neka je \(P(x, y)\) proizvoljna tacka skupa. Postavicemo uslov \(|PA| = 2\,|PB|\), zatim cemo kvadrirati obe strane i razviti izraz. Svodjenjem na kanonski oblik prepoznacemo o kojoj krivoj se radi. Ovo je klasican primer <span class="highlight">Apolonijeve kruznice</span> &mdash; geometrijskog mesta tacaka ciji je odnos rastojanja do dve fiksne tacke konstantan.</p>
  </div>

  <!-- Theory Refresher -->
  <details>
    <summary>Kljucne formule i teoreme</summary>
    <ul>
      <li><strong>Rastojanje izmedju dve tacke:</strong> \(d(P_1, P_2) = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}\)</li>
      <li><strong>Jednacina kruznice:</strong> \((x - p)^2 + (y - q)^2 = r^2\), gde je \(C(p, q)\) centar, a \(r\) poluprecnik.</li>
      <li><strong>Apolonijeva kruznica:</strong> Za dve fiksne tacke \(A\) i \(B\) i konstantu \(k > 0\), \(k \neq 1\), skup tacaka \(P\) za koje je \(\frac{|PA|}{|PB|} = k\) predstavlja kruznicu. Ako je \(k = 1\), to je simetrala duzi \(AB\) (prava).</li>
      <li><strong>Dopunjavanje do potpunog kvadrata:</strong> \(x^2 + bx = \left(x + \frac{b}{2}\right)^2 - \frac{b^2}{4}\)</li>
    </ul>
  </details>

  <!-- Canvas Visualization -->
  <div class="card canvas-card">
    <h2>Vizualizacija: Apolonijeva kruznica</h2>
    <p style="color:#94a3b8; margin-bottom: 14px;">Pomerajte klizac da menjate odnos \(k = |PA|/|PB|\) i vidite kako se menja geometrijsko mesto tacaka</p>
    <canvas id="viz-canvas" width="700" height="500"></canvas>
    <div class="slider-container">
      <label for="k-slider">Odnos k = |PA|/|PB|:</label>
      <input type="range" id="k-slider" min="0.2" max="5.0" step="0.1" value="2.0">
      <span class="slider-value" id="slider-display">2,0</span>
    </div>
    <p class="canvas-hint">Za k = 1 dobija se prava (simetrala duzi AB). Za k &ne; 1 dobija se kruznica.</p>
  </div>

  <!-- Step-by-step solution -->
  <div class="card">
    <h2>Resenje korak po korak</h2>

    <div class="step" id="step-1">
      <div class="step-badge">1</div>
      <div class="step-content">
        <h3>Postavimo uslov sa rastojanjima</h3>
        <p>Neka je \(P(x, y)\) tacka koja pripada trazenom skupu. Rastojanje od \(P\) do \(A(1, 0)\) treba da bude dva puta vece od rastojanja od \(P\) do \(B(-2, 0)\):</p>
        <div class="math-box">
          \[ |PA| = 2\,|PB| \]
        </div>
        <p>Zapisimo rastojanja pomocu formula:</p>
        <div class="math-box">
          \[ \sqrt{(x-1)^2 + y^2} = 2\,\sqrt{(x+2)^2 + y^2} \]
        </div>
      </div>
    </div>

    <div class="step" id="step-2">
      <div class="step-badge">2</div>
      <div class="step-content">
        <h3>Kvadrirajmo obe strane</h3>
        <p>Posto su obe strane nenegativne, kvadriranje je ekvivalentna transformacija:</p>
        <div class="math-box">
          \[ (x-1)^2 + y^2 = 4\,\bigl[(x+2)^2 + y^2\bigr] \]
        </div>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Zasto smemo da kvadriramo?</summary>
      <p>Obe strane jednacine su koreni, dakle nenegativne velicine. Za nenegativne brojeve vazi: \(a = b \Leftrightarrow a^2 = b^2\). Stoga kvadriranje ne uvodi lazna resenja. &check;</p>
    </details>

    <div class="step" id="step-3">
      <div class="step-badge">3</div>
      <div class="step-content">
        <h3>Raspisemo i razvijemo</h3>
        <p>Razvijemo levu stranu:</p>
        <div class="math-box">
          \[ x^2 - 2x + 1 + y^2 \]
        </div>
        <p>Razvijemo desnu stranu:</p>
        <div class="math-box">
          \[ 4\,(x^2 + 4x + 4 + y^2) = 4x^2 + 16x + 16 + 4y^2 \]
        </div>
        <p>Prenesemo sve na levu stranu:</p>
        <div class="math-box">
          \[ x^2 - 2x + 1 + y^2 - 4x^2 - 16x - 16 - 4y^2 = 0 \]
        </div>
        <div class="math-box">
          \[ -3x^2 - 18x - 3y^2 - 15 = 0 \]
        </div>
      </div>
    </div>

    <div class="step" id="step-4">
      <div class="step-badge">4</div>
      <div class="step-content">
        <h3>Podelimo jednacinu sa \(-3\)</h3>
        <p>Svodimo na jednostavniji oblik:</p>
        <div class="math-box">
          \[ x^2 + 6x + y^2 + 5 = 0 \]
        </div>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Da li smo ispravno sredili?</summary>
      <p>Proverimo: \(\frac{-3x^2}{-3} = x^2\), \(\frac{-18x}{-3} = 6x\), \(\frac{-3y^2}{-3} = y^2\), \(\frac{-15}{-3} = 5\). Sve tacno. &check;</p>
    </details>

    <div class="step" id="step-5">
      <div class="step-badge">5</div>
      <div class="step-content">
        <h3>Dopunimo do potpunog kvadrata</h3>
        <p>Dopunjavamo izraz \(x^2 + 6x\) do potpunog kvadrata:</p>
        <div class="math-box">
          \[ x^2 + 6x = (x + 3)^2 - 9 \]
        </div>
        <p>Zamenjujemo u jednacinu:</p>
        <div class="math-box">
          \[ (x + 3)^2 - 9 + y^2 + 5 = 0 \]
        </div>
        <div class="math-box">
          \[ (x + 3)^2 + y^2 = 4 \]
        </div>
      </div>
    </div>

    <div class="step" id="step-6">
      <div class="step-badge">6</div>
      <div class="step-content">
        <h3>Prepoznajemo kanonski oblik</h3>
        <p>Dobili smo jednacinu oblika \((x - p)^2 + (y - q)^2 = r^2\), gde je:</p>
        <div class="math-box">
          \[ (x + 3)^2 + (y - 0)^2 = 2^2 \]
        </div>
        <p>Ovo je <span class="highlight">jednacina kruznice</span> sa centrom \(C(-3,\; 0)\) i poluprecnikom \(r = 2\).</p>
      </div>
    </div>

    <details class="checkpoint">
      <summary>Proveri se: Da li tacka na kruznici zadovoljava polazni uslov?</summary>
      <p>Uzmimo tacku \(P(-3, 2)\) sa kruznice (jer je \((-3+3)^2 + 2^2 = 4\)).</p>
      <p>\(|PA| = \sqrt{(-3-1)^2 + 2^2} = \sqrt{16 + 4} = \sqrt{20} = 2\sqrt{5}\)</p>
      <p>\(|PB| = \sqrt{(-3+2)^2 + 2^2} = \sqrt{1 + 4} = \sqrt{5}\)</p>
      <p>Zaista: \(|PA| = 2\sqrt{5} = 2 \cdot \sqrt{5} = 2\,|PB|\). &check;</p>
    </details>
  </div>

  <!-- Key Insight -->
  <div class="card insight-card">
    <h2>Kljucni uvid</h2>
    <p>Ovo je klasican primer <strong>Apolonijeve kruznice</strong> &mdash; geometrijskog mesta tacaka ciji je odnos rastojanja do dve fiksne tacke konstantan (\(k \neq 1\)). Za tacke \(A(1, 0)\) i \(B(-2, 0)\) sa odnosom \(k = 2\), dobijamo kruznicu:</p>
    <div class="math-box" style="text-align:center; font-size:1.2rem; margin-top:16px;">
      \[ \frac{|PA|}{|PB|} = 2 \quad\Longrightarrow\quad (x+3)^2 + y^2 = 4 \]
    </div>
    <p style="margin-top: 12px; color: #94a3b8;">Zapamtite: kada je \(k = 1\), dobija se prava (simetrala duzi). Kada je \(k \neq 1\), uvek je u pitanju kruznica. Nikada elipsa, parabola ili hiperbola &mdash; jer te krive definisu <em>razlika</em> ili <em>zbir</em> rastojanja, a ne njihov <em>kolicnik</em>.</p>
  </div>

  <!-- Final Answer -->
  <div class="card final-answer">
    <h2>Konacan odgovor</h2>
    <div class="answer-big">(B) kruznicu</div>

    <div class="options-row">
      <div class="option-box">
        <div class="opt-label">(A)</div>
        <div class="opt-value">pravu</div>
      </div>
      <div class="option-box correct">
        <div class="opt-label">(B)</div>
        <div class="opt-value">kruznicu</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(C)</div>
        <div class="opt-value">elipsu</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(D)</div>
        <div class="opt-value">parabolu</div>
      </div>
      <div class="option-box">
        <div class="opt-label">(E)</div>
        <div class="opt-value">hiperbolu</div>
      </div>
    </div>

    <p class="verification"><strong>Verifikacija:</strong> Jednacina \((x+3)^2 + y^2 = 4\) opisuje kruznicu sa centrom \(C(-3,\; 0)\) i poluprecnikom \(r = 2\). Proverimo tacku \(P(-1,\; 0)\) (na kruznici jer je \((-1+3)^2 + 0 = 4\)): \(|PA| = |{-1}-1| = 2\), \(|PB| = |{-1}+2| = 1\), pa je \(|PA| = 2\,|PB|\). &check;</p>
  </div>

  <!-- Common Pitfalls -->
  <div class="card">
    <h2>Ceste greske</h2>
    <ul class="pitfall-list">
      <li><strong>Mesanje kolicnika i zbira/razlike rastojanja:</strong> Elipsa je geometrijsko mesto tacaka sa konstantnim <em>zbirom</em> rastojanja do dva fokusa. Hiperbola je definisana konstantnom <em>razlikom</em> rastojanja. Ovde je zadat konstantan <em>kolicnik</em>, sto daje kruznicu (ili pravu).</li>
      <li><strong>Greska pri kvadriranju:</strong> Cesta greska je zaboraviti da se faktor 4 primenjuje na <em>ceo</em> izraz \((x+2)^2 + y^2\), ukljucujuci i \(y^2\). Ako se \(4y^2\) ispusti, dobija se pogresna jednacina.</li>
      <li><strong>Greska u znaku pri dopunjavanju kvadrata:</strong> Kod \(x^2 + 6x\) treba dodati i oduzeti \(9\) (a ne \(3\) ili \(36\)). Uvek koristite formulu \(\left(\frac{b}{2}\right)^2\).</li>
      <li><strong>Odabir "pravu" umesto "kruznicu":</strong> Prava se dobija samo kada je \(k = 1\), tj. kada su rastojanja <em>jednaka</em>. Za \(k = 2 \neq 1\), rezultat je uvek kruznica.</li>
    </ul>
  </div>

  <!-- Optional Challenge -->
  <div class="card challenge-card">
    <h2>Dodatni izazov</h2>
    <p>Za iste tacke \(A(1, 0)\) i \(B(-2, 0)\), odredite jednacinu geometrijskog mesta tacaka \(P(x, y)\) za koje je \(|PA| = 3\,|PB|\). Koji su centar i poluprecnik te kruznice?</p>
    <details>
      <summary>Pomoc</summary>
      <p>Postavimo uslov: \((x-1)^2 + y^2 = 9\,[(x+2)^2 + y^2]\).</p>
      <p>Razvijemo: \(x^2 - 2x + 1 + y^2 = 9x^2 + 36x + 36 + 9y^2\).</p>
      <p>Sredimo: \(-8x^2 - 38x - 8y^2 - 35 = 0\), pa delimo sa \(-8\):</p>
      <p>\(x^2 + \frac{19}{4}x + y^2 + \frac{35}{8} = 0\)</p>
      <p>Dopunimo: \(\left(x + \frac{19}{8}\right)^2 + y^2 = \frac{361}{64} - \frac{35}{8} = \frac{361 - 280}{64} = \frac{81}{64}\)</p>
      <p>Centar: \(C\!\left(-\frac{19}{8},\; 0\right)\), poluprecnik: \(r = \frac{9}{8}\).</p>
    </details>
  </div>

</div>

<script>
(() => {
  // Step click interactivity
  var steps = document.querySelectorAll('.step');
  steps.forEach(function(step) {
    step.addEventListener('click', function() {
      steps.forEach(function(s) { s.classList.remove('active'); });
      step.classList.add('active');
    });
  });

  // Canvas visualization
  var canvas = document.getElementById('viz-canvas');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var W = canvas.width;
  var H = canvas.height;

  var slider = document.getElementById('k-slider');
  var display = document.getElementById('slider-display');

  // Fixed points
  var Ax = 1, Ay = 0;
  var Bx = -2, By = 0;

  function roundRect(x, y, w, h, r) {
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.lineTo(x + w - r, y);
    ctx.arcTo(x + w, y, x + w, y + r, r);
    ctx.lineTo(x + w, y + h - r);
    ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
    ctx.lineTo(x + r, y + h);
    ctx.arcTo(x, y + h, x, y + h - r, r);
    ctx.lineTo(x, y + r);
    ctx.arcTo(x, y, x + r, y, r);
    ctx.closePath();
  }

  function drawScene(k) {
    ctx.fillStyle = '#0c1222';
    ctx.fillRect(0, 0, W, H);

    // Coordinate system parameters
    var originX = W / 2 + 40;
    var originY = H / 2;
    var scale = 50; // pixels per unit

    function toScreenX(x) { return originX + x * scale; }
    function toScreenY(y) { return originY - y * scale; }

    // Grid range
    var xMin = -7, xMax = 5;
    var yMin = -5, yMax = 5;

    // Draw grid lines
    ctx.strokeStyle = 'rgba(51,65,85,0.3)';
    ctx.lineWidth = 0.5;
    for (var gx = xMin; gx <= xMax; gx++) {
      ctx.beginPath();
      ctx.moveTo(toScreenX(gx), toScreenY(yMin));
      ctx.lineTo(toScreenX(gx), toScreenY(yMax));
      ctx.stroke();
    }
    for (var gy = yMin; gy <= yMax; gy++) {
      ctx.beginPath();
      ctx.moveTo(toScreenX(xMin), toScreenY(gy));
      ctx.lineTo(toScreenX(xMax), toScreenY(gy));
      ctx.stroke();
    }

    // Draw axes
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(toScreenX(xMin), originY);
    ctx.lineTo(toScreenX(xMax), originY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(originX, toScreenY(yMin));
    ctx.lineTo(originX, toScreenY(yMax));
    ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#94a3b8';
    ctx.font = '12px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    for (var gx = xMin; gx <= xMax; gx++) {
      if (gx === 0) continue;
      ctx.fillText(gx.toString(), toScreenX(gx), originY + 18);
    }
    ctx.textAlign = 'right';
    for (var gy = yMin; gy <= yMax; gy++) {
      if (gy === 0) continue;
      ctx.fillText(gy.toString(), originX - 8, toScreenY(gy) + 4);
    }

    // Origin label
    ctx.textAlign = 'right';
    ctx.fillText('O', originX - 8, originY + 18);

    // x, y axis labels
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'italic 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('x', toScreenX(xMax) + 14, originY + 5);
    ctx.fillText('y', originX + 5, toScreenY(yMax) - 10);

    // Compute Apollonius circle for given k
    var isCircle = (Math.abs(k - 1) > 0.05);
    var cx, cy, cr;

    if (isCircle) {
      // Circle: center and radius from formula
      // |PA|^2 = k^2 |PB|^2
      // (x - Ax)^2 + y^2 = k^2 ((x - Bx)^2 + y^2)
      // Expanding and solving gives:
      // (1-k^2)x^2 - 2(Ax - k^2*Bx)x + (Ax^2 - k^2*Bx^2) + (1-k^2)y^2 = 0
      // x^2 + y^2 - 2*(Ax - k^2*Bx)/(1-k^2) * x + (Ax^2 - k^2*Bx^2)/(1-k^2) = 0
      var k2 = k * k;
      var denom = 1 - k2;
      cx = (Ax - k2 * Bx) / denom;
      cy = 0;
      var c_const = (Ax * Ax - k2 * Bx * Bx) / denom;
      cr = Math.sqrt(cx * cx - c_const);
    }

    // Draw the Apollonius circle or line
    if (isCircle && cr > 0) {
      // Glow effect
      ctx.shadowColor = '#60a5fa';
      ctx.shadowBlur = 15;
      ctx.strokeStyle = '#60a5fa';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      ctx.arc(toScreenX(cx), toScreenY(cy), cr * scale, 0, Math.PI * 2);
      ctx.stroke();
      ctx.shadowBlur = 0;

      // Fill with transparency
      ctx.fillStyle = 'rgba(96,165,250,0.06)';
      ctx.beginPath();
      ctx.arc(toScreenX(cx), toScreenY(cy), cr * scale, 0, Math.PI * 2);
      ctx.fill();

      // Center point
      ctx.fillStyle = '#a78bfa';
      ctx.beginPath();
      ctx.arc(toScreenX(cx), toScreenY(cy), 5, 0, Math.PI * 2);
      ctx.fill();

      // Center label
      ctx.fillStyle = '#a78bfa';
      ctx.font = 'bold 13px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'center';
      var cxRound = Math.round(cx * 100) / 100;
      var crRound = Math.round(cr * 100) / 100;
      ctx.fillText('C(' + cxRound.toString().replace('.', ',') + ', 0)', toScreenX(cx), toScreenY(cy) - 12);

      // Radius line (dashed)
      ctx.strokeStyle = 'rgba(167,139,250,0.5)';
      ctx.lineWidth = 1;
      ctx.setLineDash([4, 4]);
      ctx.beginPath();
      ctx.moveTo(toScreenX(cx), toScreenY(cy));
      ctx.lineTo(toScreenX(cx + cr), toScreenY(cy));
      ctx.stroke();
      ctx.setLineDash([]);

      // Radius label
      ctx.fillStyle = '#a78bfa';
      ctx.font = '12px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('r = ' + crRound.toString().replace('.', ','), toScreenX(cx + cr / 2), toScreenY(cy) - 8);
    } else {
      // Draw perpendicular bisector line (k ≈ 1)
      var midX = (Ax + Bx) / 2;
      ctx.strokeStyle = '#60a5fa';
      ctx.lineWidth = 2.5;
      ctx.shadowColor = '#60a5fa';
      ctx.shadowBlur = 15;
      ctx.beginPath();
      ctx.moveTo(toScreenX(midX), toScreenY(yMin));
      ctx.lineTo(toScreenX(midX), toScreenY(yMax));
      ctx.stroke();
      ctx.shadowBlur = 0;

      ctx.fillStyle = '#60a5fa';
      ctx.font = 'bold 13px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('Simetrala duzi AB', toScreenX(midX) + 10, toScreenY(yMax) + 25);
    }

    // Draw fixed points A and B
    // Point A
    ctx.fillStyle = '#f472b6';
    ctx.beginPath();
    ctx.arc(toScreenX(Ax), toScreenY(Ay), 7, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#0f172a';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(toScreenX(Ax), toScreenY(Ay), 7, 0, Math.PI * 2);
    ctx.stroke();

    ctx.fillStyle = '#f472b6';
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('A(1, 0)', toScreenX(Ax), toScreenY(Ay) + 24);

    // Point B
    ctx.fillStyle = '#4ade80';
    ctx.beginPath();
    ctx.arc(toScreenX(Bx), toScreenY(By), 7, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#0f172a';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(toScreenX(Bx), toScreenY(By), 7, 0, Math.PI * 2);
    ctx.stroke();

    ctx.fillStyle = '#4ade80';
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('B(-2, 0)', toScreenX(Bx), toScreenY(By) + 24);

    // Draw a sample point P on the circle and show distances
    if (isCircle && cr > 0) {
      var angle = -Math.PI / 4;
      var Px = cx + cr * Math.cos(angle);
      var Py = cy + cr * Math.sin(angle);

      // Point P
      ctx.fillStyle = '#e2e8f0';
      ctx.beginPath();
      ctx.arc(toScreenX(Px), toScreenY(Py), 5, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = '#e2e8f0';
      ctx.font = 'bold 12px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('P', toScreenX(Px) + 8, toScreenY(Py) - 4);

      // Line PA
      ctx.strokeStyle = 'rgba(244,114,182,0.5)';
      ctx.lineWidth = 1.5;
      ctx.setLineDash([5, 4]);
      ctx.beginPath();
      ctx.moveTo(toScreenX(Px), toScreenY(Py));
      ctx.lineTo(toScreenX(Ax), toScreenY(Ay));
      ctx.stroke();

      // Line PB
      ctx.strokeStyle = 'rgba(74,222,128,0.5)';
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(toScreenX(Px), toScreenY(Py));
      ctx.lineTo(toScreenX(Bx), toScreenY(By));
      ctx.stroke();
      ctx.setLineDash([]);

      // Distance labels
      var distPA = Math.sqrt((Px - Ax) * (Px - Ax) + (Py - Ay) * (Py - Ay));
      var distPB = Math.sqrt((Px - Bx) * (Px - Bx) + (Py - By) * (Py - By));

      ctx.fillStyle = '#f472b6';
      ctx.font = '11px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'center';
      var midPAx = (Px + Ax) / 2;
      var midPAy = (Py + Ay) / 2;
      ctx.fillText('|PA| = ' + distPA.toFixed(2).replace('.', ','), toScreenX(midPAx) - 10, toScreenY(midPAy) - 8);

      ctx.fillStyle = '#4ade80';
      var midPBx = (Px + Bx) / 2;
      var midPBy = (Py + By) / 2;
      ctx.fillText('|PB| = ' + distPB.toFixed(2).replace('.', ','), toScreenX(midPBx) + 10, toScreenY(midPBy) - 8);
    }

    // Title
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold 16px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Apolonijeva kruznica: |PA|/|PB| = k', W / 2, 24);

    // Info box at bottom
    var boxW = 380;
    var boxH = 55;
    var boxX = W / 2 - boxW / 2;
    var boxY = H - 70;

    ctx.shadowColor = isCircle ? '#4ade80' : '#60a5fa';
    ctx.shadowBlur = 12;
    ctx.fillStyle = 'rgba(30,41,59,0.95)';
    roundRect(boxX, boxY, boxW, boxH, 10);
    ctx.fill();
    ctx.shadowBlur = 0;

    ctx.strokeStyle = isCircle ? '#4ade80' : '#60a5fa';
    ctx.lineWidth = 2;
    roundRect(boxX, boxY, boxW, boxH, 10);
    ctx.stroke();

    if (isCircle && cr > 0) {
      ctx.fillStyle = '#e2e8f0';
      ctx.font = '13px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('k = ' + k.toFixed(1).replace('.', ',') + '  \u2192  Kruznica', W / 2, boxY + 20);
      ctx.fillStyle = '#4ade80';
      ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
      var cxDisp = cxRound.toString().replace('.', ',');
      var crDisp = crRound.toString().replace('.', ',');
      ctx.fillText('C(' + cxDisp + ', 0),  r = ' + crDisp, W / 2, boxY + 42);
    } else {
      ctx.fillStyle = '#e2e8f0';
      ctx.font = '13px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('k = 1,0  \u2192  Prava (simetrala duzi AB)', W / 2, boxY + 20);
      ctx.fillStyle = '#60a5fa';
      ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
      ctx.fillText('x = -0,5', W / 2, boxY + 42);
    }
  }

  function render() {
    var k = parseFloat(slider.value);
    display.textContent = k.toFixed(1).replace('.', ',');
    drawScene(k);
  }

  slider.addEventListener('input', function() {
    render();
  });

  slider.addEventListener('touchstart', function(e) {
    e.stopPropagation();
  });
  slider.addEventListener('touchmove', function(e) {
    e.stopPropagation();
  });

  render();
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{
  "title": "Apolonijeva kruznica - geometrijsko mesto tacaka sa zadatim odnosom rastojanja",
  "subject": "math",
  "unit": "analiticka_geometrija",
  "topic_tags": ["Apolonijeva kruznica", "geometrijsko mesto tacaka", "jednacina kruznice", "rastojanje izmedju tacaka", "analiticka geometrija u ravni"]
}
BRAINSPARK_META-->