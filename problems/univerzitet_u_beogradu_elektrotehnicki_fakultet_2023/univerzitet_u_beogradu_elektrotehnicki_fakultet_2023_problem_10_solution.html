<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zapremina zarubljene piramide</title>
<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script type="text/info" id="logic-scratchpad">
Problem: Zapremina prave pravilne cetvorostrane zarubljene piramide,
dijagonale 18 cm i stranica osnove 14 cm i 10 cm.

Given:
- Regular square frustum (truncated pyramid)
- Bottom base side: a = 14 cm
- Top base side: b = 10 cm
- Space diagonal of the frustum: d = 18 cm

Step 1: Determine the geometry
Bottom base is a square with side 14, top base is a square with side 10.
Both bases are centered (since it's a right regular frustum).

Place the frustum with center of bottom base at origin.
Bottom vertices: (7, 7, 0), (-7, 7, 0), (-7, -7, 0), (7, -7, 0)
Top vertices: (5, 5, h), (-5, 5, h), (-5, -5, h), (5, -5, h)

The "diagonal" of the frustum connects a bottom vertex to the opposite
top vertex (diagonally opposite in space).

Bottom vertex: (7, 7, 0)
Opposite top vertex: (-5, -5, h)

Distance = sqrt((7-(-5))^2 + (7-(-5))^2 + (0-h)^2)
         = sqrt(12^2 + 12^2 + h^2)
         = sqrt(144 + 144 + h^2)
         = sqrt(288 + h^2)

Set equal to 18:
sqrt(288 + h^2) = 18
288 + h^2 = 324
h^2 = 36
h = 6 cm

Step 2: Calculate areas of bases
S1 = a^2 = 14^2 = 196 cm^2
S2 = b^2 = 10^2 = 100 cm^2

Step 3: Apply frustum volume formula
V = (h/3)(S1 + S2 + sqrt(S1 * S2))
  = (6/3)(196 + 100 + sqrt(196 * 100))
  = 2 * (196 + 100 + sqrt(19600))
  = 2 * (196 + 100 + 140)
  = 2 * 436
  = 872 cm^3

Answer: (E) 872
</script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

h1 {
  font-size: 2.2rem;
  font-weight: 700;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  line-height: 1.3;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1rem;
  margin-bottom: 32px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
}

.card-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: #60a5fa;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-title .icon {
  font-size: 1.4rem;
}

.problem-statement {
  border-left: 4px solid #a78bfa;
  font-size: 1.1rem;
}

.problem-statement .problem-text {
  margin-bottom: 20px;
}

.given-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  margin-top: 16px;
}

.given-item {
  background: rgba(56, 189, 248, 0.08);
  border: 1px solid rgba(56, 189, 248, 0.15);
  border-radius: 10px;
  padding: 10px 16px;
  text-align: center;
  font-size: 1.05rem;
}

.answer-option {
  cursor: default;
  transition: transform 0.15s;
}

.math-box {
  background: rgba(56, 189, 248, 0.08);
  border: 1px solid rgba(56, 189, 248, 0.15);
  border-radius: 10px;
  padding: 16px 20px;
  margin: 14px 0;
  overflow-x: auto;
}

.step-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  border-radius: 50%;
  color: #fff;
  font-weight: 700;
  font-size: 0.95rem;
  margin-right: 10px;
  flex-shrink: 0;
}

.step-title {
  font-size: 1.15rem;
  font-weight: 600;
  color: #e2e8f0;
  display: flex;
  align-items: center;
  margin-bottom: 12px;
}

.step-explanation {
  color: #cbd5e1;
  margin-bottom: 12px;
}

details {
  background: rgba(167, 139, 250, 0.08);
  border: 1px solid rgba(167, 139, 250, 0.2);
  border-radius: 10px;
  padding: 12px 16px;
  margin: 12px 0;
}

details summary {
  cursor: pointer;
  color: #a78bfa;
  font-weight: 600;
  user-select: none;
}

details summary:hover {
  color: #c4b5fd;
}

details[open] summary {
  margin-bottom: 10px;
}

.insight-box {
  background: rgba(96, 165, 250, 0.1);
  border: 1px solid rgba(96, 165, 250, 0.3);
  border-left: 4px solid #60a5fa;
  border-radius: 12px;
  padding: 20px 24px;
  margin: 24px 0;
}

.insight-box .insight-title {
  color: #60a5fa;
  font-weight: 700;
  font-size: 1.15rem;
  margin-bottom: 8px;
}

.final-answer-card {
  background: rgba(52, 211, 153, 0.08);
  border: 2px solid rgba(52, 211, 153, 0.3);
  border-radius: 16px;
  padding: 28px;
  text-align: center;
  margin: 28px 0;
}

.final-answer-card .label {
  color: #34d399;
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 10px;
}

.final-answer-card .answer {
  font-size: 2.2rem;
  font-weight: 700;
  color: #4ade80;
  margin-bottom: 16px;
}

.final-options {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 16px;
}

.final-option {
  padding: 8px 20px;
  border-radius: 10px;
  font-size: 1.05rem;
  border: 1px solid #334155;
  background: #1e293b;
  color: #94a3b8;
}

.final-option.correct {
  background: rgba(52, 211, 153, 0.15);
  border-color: #34d399;
  color: #4ade80;
  font-weight: 700;
}

.verification-note {
  color: #94a3b8;
  font-size: 0.95rem;
  margin-top: 14px;
}

.pitfall-item {
  background: rgba(244, 114, 182, 0.08);
  border-left: 3px solid #f472b6;
  border-radius: 8px;
  padding: 12px 16px;
  margin: 10px 0;
  color: #fbb6ce;
}

.pitfall-title {
  color: #f472b6;
  font-weight: 600;
  margin-bottom: 4px;
}

canvas {
  width: 100%;
  border-radius: 12px;
  touch-action: none;
  display: block;
  margin: 0 auto;
}

.plan-text {
  color: #94a3b8;
  font-size: 1.05rem;
  line-height: 1.8;
}

.arrow {
  color: #60a5fa;
  margin: 0 4px;
}

.data-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 10px;
  margin: 16px 0;
}

.data-item {
  background: rgba(96, 165, 250, 0.08);
  border: 1px solid rgba(96, 165, 250, 0.15);
  border-radius: 10px;
  padding: 12px 16px;
  text-align: center;
}

.data-item .data-label {
  color: #94a3b8;
  font-size: 0.85rem;
  margin-bottom: 4px;
}

.data-item .data-value {
  color: #60a5fa;
  font-size: 1.15rem;
  font-weight: 600;
}

@media (max-width: 700px) {
  h1 { font-size: 1.5rem; }
  .card { padding: 16px; }
  .container { padding: 10px; }
  .given-grid { grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); }
  .final-answer-card .answer { font-size: 1.7rem; }
  .data-grid { grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); }
}
</style>
</head>
<body>
<div class="container">

  <h1>Zapremina zarubljene piramide</h1>
  <p class="subtitle">Prostorna dijagonala i formula za zapreminu zarubljene pravilne cetvorostrane piramide</p>

  <!-- Problem Statement -->
  <div class="card problem-statement">
    <div class="card-title"><span class="icon">&#128221;</span> Tekst zadatka</div>
    <div class="problem-text">
      Zapremina prave pravilne cetvorostrane zarubljene piramide, dijagonale \(18\text{ cm}\) i stranica osnove \(14\text{ cm}\) i \(10\text{ cm}\), iznosi u \(\text{cm}^3\):
    </div>
    <div class="given-grid">
      <div class="given-item answer-option" data-option="A">(A) \(436\)</div>
      <div class="given-item answer-option" data-option="B">(B) \(218\)</div>
      <div class="given-item answer-option" data-option="C">(C) \(109\)</div>
      <div class="given-item answer-option" data-option="D">(D) \(900\)</div>
      <div class="given-item answer-option" data-option="E">(E) \(872\)</div>
    </div>
  </div>

  <!-- Given Data -->
  <div class="card">
    <div class="card-title"><span class="icon">&#128202;</span> Dati podaci</div>
    <div class="data-grid">
      <div class="data-item">
        <div class="data-label">Stranica donje osnove</div>
        <div class="data-value">\(a = 14\text{ cm}\)</div>
      </div>
      <div class="data-item">
        <div class="data-label">Stranica gornje osnove</div>
        <div class="data-value">\(b = 10\text{ cm}\)</div>
      </div>
      <div class="data-item">
        <div class="data-label">Prostorna dijagonala</div>
        <div class="data-value">\(d = 18\text{ cm}\)</div>
      </div>
      <div class="data-item">
        <div class="data-label">Trazimo</div>
        <div class="data-value">\(V = \;?\)</div>
      </div>
    </div>
  </div>

  <!-- Plan -->
  <div class="card">
    <div class="card-title"><span class="icon">&#127919;</span> Plan resavanja</div>
    <p class="plan-text">
      Potrebno je naci zapreminu zarubljene piramide. Formulu za zapreminu znamo, ali nam nedostaje visina \(h\). Koristicemo prostornu dijagonalu da odredimo visinu.
    </p>
    <p class="plan-text" style="margin-top: 8px;">
      <span class="arrow">&#8594;</span> Postavi koordinatni sistem
      <span class="arrow">&#8594;</span> Izrazi dijagonalu preko \(h\)
      <span class="arrow">&#8594;</span> Izracunaj \(h\)
      <span class="arrow">&#8594;</span> Primeni formulu za zapreminu
    </p>
  </div>

  <!-- Theory Refresher -->
  <div class="card">
    <div class="card-title"><span class="icon">&#128218;</span> Podsecanje na teoriju</div>
    <details>
      <summary>Zarubljena piramida &mdash; definicija</summary>
      <p style="margin-top: 8px;">
        Zarubljena piramida (frustum) nastaje kada pravilnu piramidu presecemo ravni paralelnom sa osnovom. Dobijamo telo sa dve paralelne osnove &mdash; vecom (donjom) i manjom (gornjom).
      </p>
    </details>
    <details style="margin-top: 10px;">
      <summary>Formula za zapreminu zarubljene piramide</summary>
      <div class="math-box">
        \[ V = \frac{h}{3}\left(S_1 + S_2 + \sqrt{S_1 \cdot S_2}\right) \]
      </div>
      <p>
        gde je \(h\) visina, \(S_1\) povrsina donje osnove, a \(S_2\) povrsina gornje osnove.
      </p>
    </details>
    <details style="margin-top: 10px;">
      <summary>Prostorna dijagonala zarubljene piramide</summary>
      <p style="margin-top: 8px;">
        Prostorna dijagonala spaja teme jedne osnove sa <strong>dijagonalno suprotnim</strong> temenom druge osnove. To je najduza duz koja spaja teme donje i teme gornje osnove.
      </p>
    </details>
  </div>

  <!-- 3D Canvas Diagram -->
  <div class="card">
    <div class="card-title"><span class="icon">&#127912;</span> 3D dijagram zarubljene piramide</div>
    <p class="step-explanation" style="margin-bottom: 12px;">Povucite misem da rotirate model. Crvena linija predstavlja prostornu dijagonalu \(d = 18\).</p>
    <canvas id="frustumCanvas" width="900" height="520"></canvas>
  </div>

  <!-- Step-by-Step Solution -->
  <div class="card">
    <div class="card-title"><span class="icon">&#128736;</span> Resenje korak po korak</div>

    <!-- Step 1 -->
    <div style="margin-bottom: 24px;">
      <div class="step-title"><span class="step-badge">1</span> Postavi koordinatni sistem</div>
      <p class="step-explanation">
        Postavimo koordinatni pocetak u centar donje osnove. Posto je ovo prava pravilna zarubljena piramida, obe osnove su kvadratne i centralno poravnate.
      </p>
      <p class="step-explanation">
        Donja osnova (kvadrat stranice \(14\text{ cm}\)) ima temena:
      </p>
      <div class="math-box">
        \[ A(7,\;7,\;0),\quad B(-7,\;7,\;0),\quad C(-7,\;-7,\;0),\quad D(7,\;-7,\;0) \]
      </div>
      <p class="step-explanation">
        Gornja osnova (kvadrat stranice \(10\text{ cm}\)) ima temena:
      </p>
      <div class="math-box">
        \[ A'(5,\;5,\;h),\quad B'(-5,\;5,\;h),\quad C'(-5,\;-5,\;h),\quad D'(5,\;-5,\;h) \]
      </div>
    </div>

    <!-- Step 2 -->
    <div style="margin-bottom: 24px;">
      <div class="step-title"><span class="step-badge">2</span> Odredi prostornu dijagonalu</div>
      <p class="step-explanation">
        Prostorna dijagonala spaja teme donje osnove sa dijagonalno suprotnim temenom gornje osnove. Na primer, spaja teme \(A(7,\;7,\;0)\) sa temenom \(C'(-5,\;-5,\;h)\):
      </p>
      <div class="math-box">
        \[ d = |AC'| = \sqrt{(7-(-5))^2 + (7-(-5))^2 + (0-h)^2} \]
      </div>
      <div class="math-box">
        \[ d = \sqrt{12^2 + 12^2 + h^2} = \sqrt{144 + 144 + h^2} = \sqrt{288 + h^2} \]
      </div>
      <details>
        <summary>Zasto bas dijagonalno suprotno teme?</summary>
        <p style="margin-top: 8px;">
          Prostorna dijagonala zarubljene piramide je najduza duz koja spaja temena razlicitih osnova. Teme \(A(7,7,0)\) je najudaljenije od temena \(C'(-5,-5,h)\) jer se nalaze na suprotnim krajevima obe osnove istovremeno. Horizontalno rastojanje je \(\sqrt{12^2+12^2} = 12\sqrt{2}\), sto je maksimalno moguce.
        </p>
      </details>
    </div>

    <!-- Step 3 -->
    <div style="margin-bottom: 24px;">
      <div class="step-title"><span class="step-badge">3</span> Izracunaj visinu \(h\)</div>
      <p class="step-explanation">
        Znamo da je dijagonala \(d = 18\text{ cm}\). Uvrstimo u jednacinu:
      </p>
      <div class="math-box">
        \[ \sqrt{288 + h^2} = 18 \]
      </div>
      <p class="step-explanation">
        Kvadriramo obe strane:
      </p>
      <div class="math-box">
        \[ 288 + h^2 = 324 \]
        \[ h^2 = 324 - 288 = 36 \]
        \[ h = 6\text{ cm} \]
      </div>
      <details>
        <summary>Proveri sebe: Verifikuj dijagonalu</summary>
        <p>\(\sqrt{288 + 36} = \sqrt{324} = 18\) &#10004;</p>
      </details>
    </div>

    <!-- Step 4 -->
    <div style="margin-bottom: 24px;">
      <div class="step-title"><span class="step-badge">4</span> Izracunaj povrsine osnova</div>
      <p class="step-explanation">
        Obe osnove su kvadrati, pa su im povrsine:
      </p>
      <div class="math-box">
        \[ S_1 = a^2 = 14^2 = 196\text{ cm}^2 \]
        \[ S_2 = b^2 = 10^2 = 100\text{ cm}^2 \]
      </div>
      <p class="step-explanation">
        Geometrijska sredina povrsina:
      </p>
      <div class="math-box">
        \[ \sqrt{S_1 \cdot S_2} = \sqrt{196 \cdot 100} = \sqrt{19\,600} = 140\text{ cm}^2 \]
      </div>
    </div>

    <!-- Step 5 -->
    <div style="margin-bottom: 24px;">
      <div class="step-title"><span class="step-badge">5</span> Primeni formulu za zapreminu</div>
      <p class="step-explanation">
        Uvrstimo sve u formulu za zapreminu zarubljene piramide:
      </p>
      <div class="math-box">
        \[ V = \frac{h}{3}\left(S_1 + S_2 + \sqrt{S_1 \cdot S_2}\right) \]
      </div>
      <div class="math-box">
        \[ V = \frac{6}{3}\left(196 + 100 + 140\right) \]
      </div>
      <div class="math-box">
        \[ V = 2 \cdot 436 = \boxed{872\text{ cm}^3} \]
      </div>
      <details>
        <summary>Alternativna provera: Poredimo sa zapreminima piramida</summary>
        <p style="margin-top: 8px;">
          Kompletna piramida bi imala osnovu \(14 \times 14\) i visinu \(H\). Iz slicnosti: \(\frac{10}{14} = \frac{H - 6}{H}\), odakle \(10H = 14H - 84\), pa \(H = 21\).
        </p>
        <p style="margin-top: 4px;">
          Zapremina cele piramide: \(V_{\text{cela}} = \frac{1}{3} \cdot 196 \cdot 21 = 1372\).
        </p>
        <p style="margin-top: 4px;">
          Zapremina male piramide (odsecene): \(V_{\text{mala}} = \frac{1}{3} \cdot 100 \cdot 15 = 500\).
        </p>
        <p style="margin-top: 4px;">
          Zapremina zarubljene: \(V = 1372 - 500 = 872\text{ cm}^3\) &#10004;
        </p>
      </details>
    </div>
  </div>

  <!-- Key Insight -->
  <div class="insight-box">
    <div class="insight-title">Kljucni uvid</div>
    <p>
      Prostorna dijagonala zarubljene piramide spaja teme jedne osnove sa <strong>dijagonalno suprotnim</strong> temenom druge osnove. Horizontalna komponenta rastojanja iznosi \(\sqrt{(a/\sqrt{2} + b/\sqrt{2})^2 \cdot 2}\), sto se u nasem slucaju svodi na \(12\sqrt{2}\). Kombinovano sa visinom \(h\), ovo nam daje trojku \(12\sqrt{2}\), \(6\), \(18\) koja zadovoljava Pitagorinu teoremu: \(288 + 36 = 324\).
    </p>
  </div>

  <!-- Final Answer -->
  <div class="final-answer-card">
    <div class="label">Konacni odgovor</div>
    <div class="answer">\(V = 872\text{ cm}^3\)</div>
    <div class="final-options">
      <div class="final-option" data-option="A">(A) \(436\)</div>
      <div class="final-option" data-option="B">(B) \(218\)</div>
      <div class="final-option" data-option="C">(C) \(109\)</div>
      <div class="final-option" data-option="D">(D) \(900\)</div>
      <div class="final-option correct" data-option="E">(E) \(872\)</div>
    </div>
    <p class="verification-note">
      Verifikacija: \(\frac{6}{3}(196 + 100 + 140) = 2 \cdot 436 = 872\) &#10004;
    </p>
  </div>

  <!-- Common Pitfalls -->
  <div class="card">
    <div class="card-title"><span class="icon">&#9888;&#65039;</span> Ceste greske</div>
    <div class="pitfall-item">
      <div class="pitfall-title">Pogresna interpretacija dijagonale</div>
      <p>Dijagonala zarubljene piramide nije dijagonala osnove, niti bocna ivica! To je prostorna dijagonala koja spaja dijagonalno suprotna temena razlicitih osnova. Pogresna interpretacija bi dala pogresnu visinu.</p>
    </div>
    <div class="pitfall-item">
      <div class="pitfall-title">Zaboravljen geometrijski srednji clan</div>
      <p>Formula za zapreminu zarubljene piramide sadrzi tri clana: \(S_1 + S_2 + \sqrt{S_1 \cdot S_2}\). Cesta greska je koristiti \(\frac{h}{3}(S_1 + S_2)\) ili \(\frac{h}{2}(S_1 + S_2)\), sto daje pogresan rezultat.</p>
    </div>
    <div class="pitfall-item">
      <div class="pitfall-title">Zamena \(h/3\) sa \(h/2\)</div>
      <p>Ako bismo koristili \(h/2\) umesto \(h/3\), dobili bismo \(3 \cdot (196+100+140) = 1308\) &mdash; nijedan od ponudjenih odgovora. Zapremina zarubljene piramide uvek koristi \(h/3\).</p>
    </div>
    <div class="pitfall-item">
      <div class="pitfall-title">Odgovor (A) 436 &mdash; zaboravljen mnozilac 2</div>
      <p>Vrednost \(436\) je zbir \(S_1 + S_2 + \sqrt{S_1 \cdot S_2} = 196 + 100 + 140\), ali treba ga pomnoziti sa \(h/3 = 2\). Ovo je namerno postavljena zamka!</p>
    </div>
  </div>

  <!-- Challenge -->
  <div class="card">
    <div class="card-title"><span class="icon">&#127942;</span> Dodatni izazov</div>
    <p class="step-explanation">
      Kolika je povrsina omotaca (bocna povrsina) iste zarubljene piramide? Podsetnik: bocna strana je jednakokraki trapez. Potrebno je naci apotemu zarubljene piramide.
    </p>
    <details>
      <summary>Nagovestaj</summary>
      <p style="margin-top: 8px;">
        Apotema zarubljene piramide je visina bocne strane. Njena horizontalna komponenta je \(\frac{a-b}{2} = \frac{14-10}{2} = 2\text{ cm}\). Posto je visina piramide \(h = 6\), apotema je \(l = \sqrt{h^2 + \left(\frac{a-b}{2}\right)^2} = \sqrt{36 + 4} = \sqrt{40} = 2\sqrt{10}\text{ cm}\). Povrsina omotaca je \(P = \frac{1}{2}(o_1 + o_2) \cdot l = \frac{1}{2}(56+40) \cdot 2\sqrt{10} = 96\sqrt{10}\text{ cm}^2\).
      </p>
    </details>
  </div>

</div>

<script>
(() => {
  const canvas = document.getElementById('frustumCanvas');
  const ctx = canvas.getContext('2d');

  let angleX = 0.35;
  let angleY = -0.45;
  let isDragging = false;
  let lastMouse = { x: 0, y: 0 };

  // 3D vertices of the frustum
  // Bottom base: side 14, top base: side 10, height: 6
  const a = 7, b = 5, h = 6;
  const scale3D = 16;

  const bottomVerts = [
    [a, -h/2, a], [-a, -h/2, a], [-a, -h/2, -a], [a, -h/2, -a]
  ];
  const topVerts = [
    [b, h/2, b], [-b, h/2, b], [-b, h/2, -b], [b, h/2, -b]
  ];

  function rotateY(p, angle) {
    const c = Math.cos(angle), s = Math.sin(angle);
    return [p[0]*c + p[2]*s, p[1], -p[0]*s + p[2]*c];
  }

  function rotateX(p, angle) {
    const c = Math.cos(angle), s = Math.sin(angle);
    return [p[0], p[1]*c - p[2]*s, p[1]*s + p[2]*c];
  }

  function project(p, W, H) {
    const d = 200;
    const z = p[2] + d;
    const f = d / z;
    return [W/2 + p[0] * f * scale3D, H/2 - p[1] * f * scale3D, z];
  }

  function transform(p, W, H) {
    let r = rotateY(p, angleY);
    r = rotateX(r, angleX);
    return project(r, W, H);
  }

  function draw() {
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = 520 * dpr;
    ctx.scale(dpr, dpr);

    const W = rect.width;
    const H = 520;

    ctx.fillStyle = '#0f172a';
    ctx.fillRect(0, 0, W, H);

    // Transform all vertices
    const bProj = bottomVerts.map(v => transform(v, W, H));
    const tProj = topVerts.map(v => transform(v, W, H));

    // Labels for vertices
    const bLabels = ['A', 'B', 'C', 'D'];
    const tLabels = ["A'", "B'", "C'", "D'"];

    // Draw faces with transparency (back faces first)
    // Bottom face
    drawFace(bProj, 'rgba(96, 165, 250, 0.08)', 'rgba(96, 165, 250, 0.4)');
    // Top face
    drawFace(tProj, 'rgba(167, 139, 250, 0.08)', 'rgba(167, 139, 250, 0.4)');

    // Draw lateral edges
    for (let i = 0; i < 4; i++) {
      drawLine(bProj[i], tProj[i], '#475569', 1.5);
    }

    // Draw bottom edges
    for (let i = 0; i < 4; i++) {
      drawLine(bProj[i], bProj[(i+1)%4], '#60a5fa', 2);
    }

    // Draw top edges
    for (let i = 0; i < 4; i++) {
      drawLine(tProj[i], tProj[(i+1)%4], '#a78bfa', 2);
    }

    // Draw the space diagonal: A(7,7,0) to C'(-5,-5,h)
    // In our coordinate system: bottom[0] = (a, -h/2, a), top[2] = (-b, h/2, -b)
    drawLine(bProj[0], tProj[2], '#ef4444', 3);

    // Draw height line (dashed) from center bottom to center top
    const centerBottom = transform([0, -h/2, 0], W, H);
    const centerTop = transform([0, h/2, 0], W, H);
    drawDashedLine(centerBottom, centerTop, '#34d399', 2);

    // Label the diagonal
    const diagMidX = (bProj[0][0] + tProj[2][0]) / 2;
    const diagMidY = (bProj[0][1] + tProj[2][1]) / 2;
    ctx.fillStyle = '#ef4444';
    ctx.font = 'bold 16px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('d = 18', diagMidX + 10, diagMidY - 5);

    // Label height
    const hMidX = (centerBottom[0] + centerTop[0]) / 2;
    const hMidY = (centerBottom[1] + centerTop[1]) / 2;
    ctx.fillStyle = '#34d399';
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText('h = 6', hMidX - 10, hMidY);

    // Label vertices
    ctx.font = 'bold 14px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    for (let i = 0; i < 4; i++) {
      ctx.fillStyle = '#60a5fa';
      ctx.fillText(bLabels[i], bProj[i][0], bProj[i][1] + 20);
      ctx.fillStyle = '#a78bfa';
      ctx.fillText(tLabels[i], tProj[i][0], tProj[i][1] - 10);
    }

    // Label base dimensions
    const bottomMidX = (bProj[0][0] + bProj[1][0]) / 2;
    const bottomMidY = (bProj[0][1] + bProj[1][1]) / 2;
    ctx.fillStyle = '#60a5fa';
    ctx.font = '13px Segoe UI, system-ui, sans-serif';
    ctx.fillText('a = 14', bottomMidX, bottomMidY + 20);

    const topMidX = (tProj[0][0] + tProj[1][0]) / 2;
    const topMidY = (tProj[0][1] + tProj[1][1]) / 2;
    ctx.fillStyle = '#a78bfa';
    ctx.fillText('b = 10', topMidX, topMidY - 18);

    // Legend
    ctx.textAlign = 'left';
    ctx.font = '13px Segoe UI, system-ui, sans-serif';
    const legendX = 20, legendY = H - 60;

    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 3;
    ctx.beginPath(); ctx.moveTo(legendX, legendY); ctx.lineTo(legendX + 30, legendY); ctx.stroke();
    ctx.fillStyle = '#e2e8f0';
    ctx.fillText('Prostorna dijagonala (d = 18)', legendX + 38, legendY + 4);

    ctx.strokeStyle = '#34d399';
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 4]);
    ctx.beginPath(); ctx.moveTo(legendX, legendY + 22); ctx.lineTo(legendX + 30, legendY + 22); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#e2e8f0';
    ctx.fillText('Visina (h = 6)', legendX + 38, legendY + 26);
  }

  function drawFace(verts, fill, stroke) {
    ctx.beginPath();
    ctx.moveTo(verts[0][0], verts[0][1]);
    for (let i = 1; i < verts.length; i++) {
      ctx.lineTo(verts[i][0], verts[i][1]);
    }
    ctx.closePath();
    ctx.fillStyle = fill;
    ctx.fill();
    ctx.strokeStyle = stroke;
    ctx.lineWidth = 1;
    ctx.stroke();
  }

  function drawLine(a, b, color, width) {
    ctx.beginPath();
    ctx.moveTo(a[0], a[1]);
    ctx.lineTo(b[0], b[1]);
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.stroke();
  }

  function drawDashedLine(a, b, color, width) {
    ctx.beginPath();
    ctx.setLineDash([6, 4]);
    ctx.moveTo(a[0], a[1]);
    ctx.lineTo(b[0], b[1]);
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // Mouse interaction for rotation
  canvas.addEventListener('pointerdown', function(e) {
    isDragging = true;
    lastMouse = { x: e.clientX, y: e.clientY };
    canvas.setPointerCapture(e.pointerId);
  });

  canvas.addEventListener('pointermove', function(e) {
    if (!isDragging) return;
    const dx = e.clientX - lastMouse.x;
    const dy = e.clientY - lastMouse.y;
    angleY += dx * 0.008;
    angleX += dy * 0.008;
    angleX = Math.max(-Math.PI / 2.2, Math.min(Math.PI / 2.2, angleX));
    lastMouse = { x: e.clientX, y: e.clientY };
    draw();
  });

  canvas.addEventListener('pointerup', function(e) {
    isDragging = false;
    canvas.releasePointerCapture(e.pointerId);
  });

  draw();
  window.addEventListener('resize', draw);
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{"title":"Zapremina zarubljene pravilne cetvorostrane piramide","subject":"math","unit":"geometry","topic_tags":["stereometrija","zarubljena piramida","zapremina","prostorna dijagonala","pravilna cetvorostrana piramida"]}
BRAINSPARK_META-->