<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Centar kruznice na pravoj</title>
<script type="text/info" id="logic-scratchpad">
PROBLEM:
Center C(p, q) of a circle with radius r lies on the line 5x - 3y + 12 = 0.
The circle passes through points A(1, -3) and B(1, 1).
Find p + q + r².

SOLUTION:
Step 1: Since A(1, -3) and B(1, 1) both lie on the circle, CA = CB = r.
The center C must lie on the perpendicular bisector of segment AB.

Step 2: Find the perpendicular bisector of AB.
A = (1, -3), B = (1, 1)
Midpoint M = ((1+1)/2, (-3+1)/2) = (1, -1)
AB is vertical (both points have x = 1), so the perpendicular bisector is horizontal: y = -1.
Therefore q = -1.

Step 3: C(p, q) lies on line 5x - 3y + 12 = 0.
Substitute q = -1:
5p - 3(-1) + 12 = 0
5p + 3 + 12 = 0
5p + 15 = 0
5p = -15
p = -3

So C = (-3, -1).

Step 4: Find r².
r² = CA² = (p - 1)² + (q - (-3))² = (-3 - 1)² + (-1 + 3)² = (-4)² + (2)² = 16 + 4 = 20

Verification with B:
r² = CB² = (-3 - 1)² + (-1 - 1)² = (-4)² + (-2)² = 16 + 4 = 20 ✓

Step 5: Compute p + q + r².
p + q + r² = -3 + (-1) + 20 = 16

ANSWER: B) 16

Verification:
- C(-3, -1) on line 5x - 3y + 12 = 0: 5(-3) - 3(-1) + 12 = -15 + 3 + 12 = 0 ✓
- CA² = (-3-1)² + (-1+3)² = 16 + 4 = 20 ✓
- CB² = (-3-1)² + (-1-1)² = 16 + 4 = 20 ✓
- p + q + r² = -3 + (-1) + 20 = 16 ✓
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 10px;
}

h1 {
  font-size: 2.2rem;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  line-height: 1.3;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.05rem;
  margin-bottom: 30px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

.card h2 {
  color: #60a5fa;
  font-size: 1.4rem;
  margin-bottom: 16px;
}

.card h3 {
  color: #e2e8f0;
  font-size: 1.15rem;
  margin-bottom: 10px;
}

.highlight-value {
  color: #f472b6;
  font-weight: 600;
}

.given-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 16px;
}

.given-item {
  background: rgba(56, 189, 248, 0.06);
  border: 1px solid rgba(56, 189, 248, 0.12);
  border-radius: 10px;
  padding: 12px 18px;
  min-width: 90px;
  text-align: center;
}

.given-item .label {
  color: #94a3b8;
  font-size: 0.82rem;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.given-item .value {
  color: #e2e8f0;
  font-size: 1.1rem;
  font-weight: 600;
}

.answer-option {
  cursor: default;
  transition: none;
}

.plan-card {
  border-left: 3px solid #a78bfa;
}

.plan-card p {
  color: #c4b5fd;
  font-size: 1.02rem;
}

details {
  margin: 15px 0;
}

details summary {
  cursor: pointer;
  color: #60a5fa;
  font-weight: 600;
  font-size: 1.05rem;
  padding: 8px 0;
  user-select: none;
}

details summary:hover {
  color: #93c5fd;
}

details[open] summary {
  margin-bottom: 12px;
}

.theory-content ul {
  list-style: none;
  padding: 0;
}

.theory-content li {
  padding: 8px 12px;
  margin-bottom: 8px;
  background: rgba(96, 165, 250, 0.06);
  border-radius: 8px;
  border-left: 3px solid #60a5fa;
  line-height: 1.8;
}

.canvas-container {
  text-align: center;
  margin: 16px 0;
}

.canvas-container canvas {
  border-radius: 12px;
  border: 1px solid #334155;
  background: #0c1222;
  max-width: 100%;
  touch-action: none;
}

.drag-hint {
  color: #64748b;
  font-size: 0.82rem;
  margin-top: 8px;
  font-style: italic;
}

.step-container {
  display: flex;
  gap: 16px;
  align-items: flex-start;
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 10px;
  border-left: 3px solid transparent;
  transition: border-color 0.2s, background 0.2s;
  cursor: pointer;
}

.step-container:hover,
.step-container.active {
  border-left-color: #4ade80;
  background: rgba(74, 222, 128, 0.04);
}

.step-badge {
  width: 32px;
  height: 32px;
  min-width: 32px;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.9rem;
  color: #0f172a;
  margin-top: 2px;
}

.step-content {
  flex: 1;
}

.step-content p {
  margin-bottom: 8px;
  line-height: 1.7;
}

.math-block {
  background: rgba(56, 189, 248, 0.08);
  border: 1px solid rgba(56, 189, 248, 0.15);
  border-radius: 8px;
  padding: 14px 18px;
  margin: 10px 0;
  font-family: 'Courier New', monospace;
  overflow-x: auto;
  line-height: 2;
}

.checkpoint {
  background: rgba(167, 139, 250, 0.08);
  border: 1px solid rgba(167, 139, 250, 0.2);
  border-radius: 10px;
  padding: 14px 18px;
  margin: 15px 0;
}

.checkpoint summary {
  color: #a78bfa;
  font-size: 0.95rem;
}

.checkpoint p {
  margin-top: 8px;
  color: #c4b5fd;
}

.insight-box {
  background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.1));
  border: 1px solid rgba(167, 139, 250, 0.25);
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  text-align: center;
}

.insight-box h2 {
  color: #a78bfa;
}

.insight-formula {
  font-size: 1.4rem;
  color: #4ade80;
  margin: 16px 0;
}

.final-answer {
  background: linear-gradient(135deg, rgba(52, 211, 153, 0.08), rgba(74, 222, 128, 0.12));
  border: 1px solid rgba(52, 211, 153, 0.25);
  border-radius: 14px;
  padding: 28px;
  margin-bottom: 24px;
  text-align: center;
}

.final-answer h2 {
  color: #34d399;
  margin-bottom: 16px;
}

.final-answer .answer-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #4ade80;
  margin: 12px 0;
}

.final-options {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  margin: 20px 0;
}

.final-option {
  padding: 10px 22px;
  border-radius: 10px;
  font-size: 1.05rem;
  font-weight: 600;
  border: 2px solid #334155;
  background: #1e293b;
  color: #94a3b8;
}

.final-option.correct {
  border-color: #4ade80;
  background: rgba(74, 222, 128, 0.12);
  color: #4ade80;
}

.verification-note {
  color: #94a3b8;
  font-size: 0.92rem;
  margin-top: 16px;
  text-align: left;
  background: rgba(148, 163, 184, 0.06);
  padding: 14px;
  border-radius: 8px;
  line-height: 1.7;
}

.pitfalls-card {
  border-left: 3px solid #e09468;
}

.pitfalls-card h2 {
  color: #e09468;
}

.pitfalls-card ul {
  list-style: none;
  padding: 0;
}

.pitfalls-card li {
  padding: 8px 12px;
  margin-bottom: 8px;
  background: rgba(224, 148, 104, 0.06);
  border-radius: 8px;
  border-left: 3px solid #e09468;
  color: #d4b896;
}

.challenge-card details summary {
  color: #f472b6;
}

.challenge-card {
  border-left: 3px solid #f472b6;
}

.note-text {
  color: #94a3b8;
  font-size: 0.9rem;
  font-style: italic;
}

@media (max-width: 700px) {
  h1 { font-size: 1.5rem; }
  .card { padding: 16px; }
  .given-grid { gap: 8px; }
  .given-item { min-width: 70px; padding: 8px 12px; }
  .step-container { padding: 12px; gap: 10px; }
  .final-options { gap: 8px; }
  .final-option { padding: 8px 14px; font-size: 0.95rem; }
}
</style>
</head>
<body>
<div class="container">

  <!-- TITLE -->
  <h1>Centar kruznice na datoj pravoj</h1>
  <p class="subtitle">Analitička geometrija — jednačina kruznice, simetrala duzi, prava</p>

  <!-- PROBLEM STATEMENT -->
  <div class="card problem-statement">
    <h2>Postavka zadatka</h2>
    <p>
      Centar \( C(p, q) \) kruznice poluprečnika \( r \) pripada pravoj
      <span class="highlight-value">\( 5x - 3y + 12 = 0 \)</span>. Ako ta kruznica sadrzi tačke
      <span class="highlight-value">\( A(1, -3) \)</span> i
      <span class="highlight-value">\( B(1, 1) \)</span>, onda izraz
      <span class="highlight-value">\( p + q + r^2 \)</span> iznosi:
    </p>

    <div class="given-grid">
      <div class="given-item">
        <div class="label">Prava</div>
        <div class="value">\(5x - 3y + 12 = 0\)</div>
      </div>
      <div class="given-item">
        <div class="label">Tačka A</div>
        <div class="value">\((1,\, -3)\)</div>
      </div>
      <div class="given-item">
        <div class="label">Tačka B</div>
        <div class="value">\((1,\, 1)\)</div>
      </div>
      <div class="given-item">
        <div class="label">Traži se</div>
        <div class="value">\(p + q + r^2\)</div>
      </div>
    </div>

    <div class="given-grid" style="margin-top: 18px;">
      <div class="given-item answer-option" data-option="A">
        <div class="label">(A)</div>
        <div class="value">\(20\)</div>
      </div>
      <div class="given-item answer-option" data-option="B">
        <div class="label">(B)</div>
        <div class="value">\(16\)</div>
      </div>
      <div class="given-item answer-option" data-option="C">
        <div class="label">(C)</div>
        <div class="value">\(18\)</div>
      </div>
      <div class="given-item answer-option" data-option="D">
        <div class="label">(D)</div>
        <div class="value">\(24\)</div>
      </div>
      <div class="given-item answer-option" data-option="E">
        <div class="label">(E)</div>
        <div class="value">\(17\)</div>
      </div>
    </div>
  </div>

  <!-- PLAN -->
  <div class="card plan-card">
    <h2>Plan resavanja</h2>
    <p>
      Koristićemo činjenicu da centar kruznice lezi na simetrali duzi \( AB \).
      Iz uslova da centar pripada i datoj pravoj, odredićemo koordinate centra \( (p, q) \),
      a zatim izračunati \( r^2 \) kao rastojanje od centra do bilo koje od datih tačaka.
    </p>
  </div>

  <!-- THEORY REFRESHER -->
  <div class="card">
    <details>
      <summary>Ključne formule i teoreme</summary>
      <div class="theory-content">
        <ul>
          <li>
            <strong>Jednačina kruznice:</strong>
            \( (x - p)^2 + (y - q)^2 = r^2 \), gde je \( C(p, q) \) centar, a \( r \) poluprečnik.
          </li>
          <li>
            <strong>Simetrala duzi:</strong> Centar kruznice koja prolazi kroz dve tačke lezi
            na simetrali duzi koja spaja te dve tačke. Simetrala je prava normalna na duz
            i prolazi kroz njeno srediste.
          </li>
          <li>
            <strong>Srediste duzi:</strong> Za tačke \( A(x_1, y_1) \) i \( B(x_2, y_2) \),
            srediste je \( M = \left(\frac{x_1 + x_2}{2},\, \frac{y_1 + y_2}{2}\right) \).
          </li>
          <li>
            <strong>Rastojanje između dve tačke:</strong>
            \( d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} \)
          </li>
        </ul>
      </div>
    </details>
  </div>

  <!-- VISUAL AID -->
  <div class="card">
    <h2>Geometrijska ilustracija</h2>
    <div class="canvas-container">
      <canvas id="mainCanvas" width="700" height="550"></canvas>
      <p class="drag-hint">Prevucite tačke A ili B da vidite kako se menja centar kruznice</p>
    </div>
  </div>

  <!-- STEP-BY-STEP SOLUTION -->
  <div class="card">
    <h2>Resenje korak po korak</h2>

    <!-- Step 1 -->
    <div class="step-container" id="step1">
      <div class="step-badge">1</div>
      <div class="step-content">
        <h3>Uočavamo svojstvo tačaka A i B</h3>
        <p>
          Obe tačke \( A(1, -3) \) i \( B(1, 1) \) imaju istu \( x \)-koordinatu: \( x = 1 \).
          To znači da je duz \( AB \) <strong>vertikalna</strong> (paralelna sa \( y \)-osom).
        </p>
        <div class="math-block">
          \[ A = (1,\, -3), \quad B = (1,\, 1) \]
          \[ \text{Duz } AB \text{ je vertikalna jer je } x_A = x_B = 1 \]
        </div>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="step-container" id="step2">
      <div class="step-badge">2</div>
      <div class="step-content">
        <h3>Nalazimo simetralu duzi AB</h3>
        <p>
          Centar kruznice koja prolazi kroz dve tačke uvek lezi na simetrali duzi
          koja ih spaja. Prvo nalazimo srediste duzi \( AB \):
        </p>
        <div class="math-block">
          \[ M = \left(\frac{1 + 1}{2},\, \frac{-3 + 1}{2}\right) = (1,\, -1) \]
        </div>
        <p>
          Posto je duz \( AB \) vertikalna, njena simetrala je <strong>horizontalna</strong>
          prava koja prolazi kroz srediste \( M \):
        </p>
        <div class="math-block">
          \[ \text{Simetrala duzi } AB: \quad y = -1 \]
        </div>
        <p>
          Dakle, \( y \)-koordinata centra kruznice je:
        </p>
        <div class="math-block">
          \[ \boxed{q = -1} \]
        </div>
      </div>
    </div>

    <!-- Checkpoint 1 -->
    <details class="checkpoint">
      <summary>Proveri sebe: Zasto centar lezi na simetrali duzi AB?</summary>
      <p>
        Zato sto je centar kruznice jednako udaljen od svih tačaka na kruznici.
        Posto \( A \) i \( B \) leze na kruznici, vazi \( CA = CB = r \), pa centar mora
        lezati na geometrijskom mestu tačaka jednakih rastojanja od \( A \) i \( B \)
        — a to je upravo simetrala duzi \( AB \).
      </p>
    </details>

    <!-- Step 3 -->
    <div class="step-container" id="step3">
      <div class="step-badge">3</div>
      <div class="step-content">
        <h3>Koristimo uslov da centar lezi na datoj pravoj</h3>
        <p>
          Centar \( C(p, q) \) pripada pravoj \( 5x - 3y + 12 = 0 \).
          Zamenjujemo \( q = -1 \):
        </p>
        <div class="math-block">
          \[ 5p - 3 \cdot (-1) + 12 = 0 \]
        </div>
        <div class="math-block">
          \[ 5p + 3 + 12 = 0 \]
        </div>
        <div class="math-block">
          \[ 5p + 15 = 0 \]
        </div>
        <div class="math-block">
          \[ 5p = -15 \]
        </div>
        <div class="math-block">
          \[ \boxed{p = -3} \]
        </div>
        <p>
          Centar kruznice je \( C(-3,\, -1) \).
        </p>
      </div>
    </div>

    <!-- Checkpoint 2 -->
    <details class="checkpoint">
      <summary>Proveri sebe: Da li centar C(-3, -1) zaista lezi na pravoj 5x - 3y + 12 = 0?</summary>
      <p>
        Proveravamo: \( 5 \cdot (-3) - 3 \cdot (-1) + 12 = -15 + 3 + 12 = 0 \). Da, tačno!
      </p>
    </details>

    <!-- Step 4 -->
    <div class="step-container" id="step4">
      <div class="step-badge">4</div>
      <div class="step-content">
        <h3>Računamo \( r^2 \)</h3>
        <p>
          Poluprečnik je rastojanje od centra \( C(-3, -1) \) do tačke \( A(1, -3) \):
        </p>
        <div class="math-block">
          \[ r^2 = (p - 1)^2 + (q - (-3))^2 \]
        </div>
        <div class="math-block">
          \[ r^2 = (-3 - 1)^2 + (-1 + 3)^2 \]
        </div>
        <div class="math-block">
          \[ r^2 = (-4)^2 + (2)^2 \]
        </div>
        <div class="math-block">
          \[ r^2 = 16 + 4 = 20 \]
        </div>
        <p class="note-text">
          Proverimo i sa tačkom B: \( r^2 = (-3 - 1)^2 + (-1 - 1)^2 = 16 + 4 = 20 \). Potvrdjeno!
        </p>
      </div>
    </div>

    <!-- Step 5 -->
    <div class="step-container" id="step5">
      <div class="step-badge">5</div>
      <div class="step-content">
        <h3>Izračunavamo trazeni izraz \( p + q + r^2 \)</h3>
        <div class="math-block">
          \[ p + q + r^2 = (-3) + (-1) + 20 \]
        </div>
        <div class="math-block">
          \[ p + q + r^2 = -4 + 20 \]
        </div>
        <div class="math-block">
          \[ \boxed{p + q + r^2 = 16} \]
        </div>
      </div>
    </div>

    <!-- Checkpoint 3 -->
    <details class="checkpoint">
      <summary>Proveri sebe: Koliko iznosi poluprečnik r?</summary>
      <p>
        \( r = \sqrt{20} = 2\sqrt{5} \approx 4{,}47 \). To je razumna vrednost —
        kruznica prolazi kroz tačke koje su udaljene 4 po vertikali, pa poluprečnik
        mora biti veći od 2 (polovina te udaljenosti).
      </p>
    </details>
  </div>

  <!-- KEY INSIGHT -->
  <div class="insight-box">
    <h2>Ključni uvid</h2>
    <p style="margin-bottom: 12px;">
      Centar kruznice koja prolazi kroz dve tačke uvek lezi na simetrali duzi
      koja ih spaja. Kada su tačke vertikalno poravnate, simetrala je horizontalna prava,
      sto odmah daje jednu koordinatu centra!
    </p>
    <div class="insight-formula">
      \[ C \in \text{simetrala}(AB) \cap \text{prava}(5x - 3y + 12 = 0) \implies C = (-3,\, -1) \]
    </div>
  </div>

  <!-- FINAL ANSWER -->
  <div class="final-answer">
    <h2>Konačan odgovor</h2>
    <div class="answer-value">\( p + q + r^2 = 16 \)</div>

    <div class="final-options">
      <div class="final-option">(A) 20</div>
      <div class="final-option correct">(B) 16</div>
      <div class="final-option">(C) 18</div>
      <div class="final-option">(D) 24</div>
      <div class="final-option">(E) 17</div>
    </div>

    <div class="verification-note">
      <strong>Verifikacija:</strong><br>
      1. Centar \( C(-3, -1) \) na pravoj: \( 5(-3) - 3(-1) + 12 = -15 + 3 + 12 = 0 \) — tačno.<br>
      2. Rastojanje \( CA = \sqrt{(-4)^2 + 2^2} = \sqrt{20} = 2\sqrt{5} \) — tačno.<br>
      3. Rastojanje \( CB = \sqrt{(-4)^2 + (-2)^2} = \sqrt{20} = 2\sqrt{5} \) — tačno, \( CA = CB \).<br>
      4. \( p + q + r^2 = -3 + (-1) + 20 = 16 \) — odgovor (B).
    </div>
  </div>

  <!-- COMMON PITFALLS -->
  <div class="card pitfalls-card">
    <h2>Česte greske</h2>
    <ul>
      <li>
        <strong>Zaboraviti minus u zameni:</strong> Kada se \( q = -1 \) zameni u jednačinu
        prave, čest je propust u znaku: \( -3 \cdot (-1) = +3 \), ne \( -3 \). Pazljivo
        sa dvostrukim minusom!
      </li>
      <li>
        <strong>Mešanje \( r \) i \( r^2 \):</strong> Zadatak trazi \( p + q + r^2 \), ne
        \( p + q + r \). Ako biste koristili \( r = 2\sqrt{5} \approx 4{,}47 \) umesto
        \( r^2 = 20 \), dobili biste pogresan rezultat.
      </li>
    </ul>
  </div>

  <!-- OPTIONAL CHALLENGE -->
  <div class="card challenge-card">
    <h2>Dodatni izazov</h2>
    <p>
      Kako bi se zadatak promenio da tačke \( A \) i \( B \) nemaju istu \( x \)-koordinatu,
      npr. \( A(0, -2) \) i \( B(4, 2) \)? Pokusajte da nadjete jednačinu simetrale duzi
      \( AB \) u opštem slučaju.
    </p>
    <details>
      <summary>Nagoveštaj</summary>
      <p>
        Nadjite nagib duzi \( AB \), zatim nagib simetrale (negativna recipročna vrednost),
        i koristite srediste duzi da formirate jednačinu prave. Presek te prave i date prave
        daje centar kruznice.
      </p>
    </details>
  </div>

</div>

<script>
(() => {
  // Main diagram canvas
  const canvas = document.getElementById('mainCanvas');
  const ctx = canvas.getContext('2d');

  // Problem data
  const A_ORIG = { x: 1, y: -3 };
  const B_ORIG = { x: 1, y: 1 };

  // Draggable points
  let A = { ...A_ORIG };
  let B = { ...B_ORIG };

  // Coordinate system
  const originX = 400;
  const originY = 310;
  const scale = 50;

  function toCanvas(x, y) {
    return { x: originX + x * scale, y: originY - y * scale };
  }

  function fromCanvas(cx, cy) {
    return { x: (cx - originX) / scale, y: -(cy - originY) / scale };
  }

  // Compute center given A, B on the line 5x - 3y + 12 = 0
  function computeCenter(a, b) {
    // Midpoint
    const mx = (a.x + b.x) / 2;
    const my = (a.y + b.y) / 2;

    // Direction of AB
    const dx = b.x - a.x;
    const dy = b.y - a.y;

    // Perpendicular bisector: passes through (mx, my) with direction (-dy, dx)
    // Parametric: x = mx - dy*t, y = my + dx*t
    // Substitute into 5x - 3y + 12 = 0:
    // 5(mx - dy*t) - 3(my + dx*t) + 12 = 0
    // 5*mx - 5*dy*t - 3*my - 3*dx*t + 12 = 0
    // t(-5*dy - 3*dx) = -(5*mx - 3*my + 12)
    const denom = -5 * dy - 3 * dx;
    if (Math.abs(denom) < 1e-10) return null;
    const t = -(5 * mx - 3 * my + 12) / denom;

    const cx = mx - dy * t;
    const cy = my + dx * t;
    return { x: cx, y: cy };
  }

  let dragging = null;
  const DRAG_RADIUS = 18;

  function getMousePos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
      x: (e.clientX - rect.left) * scaleX,
      y: (e.clientY - rect.top) * scaleY
    };
  }

  function getTouchPos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    const touch = e.touches[0];
    return {
      x: (touch.clientX - rect.left) * scaleX,
      y: (touch.clientY - rect.top) * scaleY
    };
  }

  function hitTest(pos, point) {
    const cp = toCanvas(point.x, point.y);
    const dx = pos.x - cp.x;
    const dy = pos.y - cp.y;
    return Math.sqrt(dx * dx + dy * dy) < DRAG_RADIUS;
  }

  canvas.addEventListener('mousedown', (e) => {
    const pos = getMousePos(e);
    if (hitTest(pos, A)) dragging = 'A';
    else if (hitTest(pos, B)) dragging = 'B';
  });

  canvas.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    const pos = getMousePos(e);
    const pt = fromCanvas(pos.x, pos.y);
    if (dragging === 'A') { A.x = pt.x; A.y = pt.y; }
    else { B.x = pt.x; B.y = pt.y; }
    draw();
  });

  canvas.addEventListener('mouseup', () => { dragging = null; });
  canvas.addEventListener('mouseleave', () => { dragging = null; });

  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const pos = getTouchPos(e);
    if (hitTest(pos, A)) dragging = 'A';
    else if (hitTest(pos, B)) dragging = 'B';
  });

  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!dragging) return;
    const pos = getTouchPos(e);
    const pt = fromCanvas(pos.x, pos.y);
    if (dragging === 'A') { A.x = pt.x; A.y = pt.y; }
    else { B.x = pt.x; B.y = pt.y; }
    draw();
  });

  canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    dragging = null;
  });

  function draw() {
    const W = canvas.width;
    const H = canvas.height;
    ctx.clearRect(0, 0, W, H);

    // Background
    ctx.fillStyle = '#0c1222';
    ctx.fillRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 1;
    for (let x = -10; x <= 10; x++) {
      const cx = originX + x * scale;
      ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, H); ctx.stroke();
    }
    for (let y = -10; y <= 10; y++) {
      const cy = originY - y * scale;
      ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(W, cy); ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(0, originY); ctx.lineTo(W, originY); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(originX, 0); ctx.lineTo(originX, H); ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#64748b';
    ctx.font = '13px Segoe UI, sans-serif';
    ctx.textAlign = 'center';
    for (let x = -7; x <= 5; x++) {
      if (x === 0) continue;
      const cx = originX + x * scale;
      ctx.fillText(x.toString(), cx, originY + 18);
    }
    ctx.textAlign = 'right';
    for (let y = -5; y <= 5; y++) {
      if (y === 0) continue;
      const cy = originY - y * scale;
      ctx.fillText(y.toString(), originX - 8, cy + 5);
    }
    ctx.fillText('0', originX - 8, originY + 18);

    // Axis arrow labels
    ctx.fillStyle = '#64748b';
    ctx.font = 'bold 14px Segoe UI, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('x', W - 18, originY - 8);
    ctx.textAlign = 'center';
    ctx.fillText('y', originX + 14, 16);

    // Draw line 5x - 3y + 12 = 0 => y = (5x + 12) / 3
    ctx.strokeStyle = 'rgba(96, 165, 250, 0.5)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for (let px = 0; px < W; px++) {
      const x = (px - originX) / scale;
      const y = (5 * x + 12) / 3;
      const cy = originY - y * scale;
      if (px === 0) ctx.moveTo(px, cy);
      else ctx.lineTo(px, cy);
    }
    ctx.stroke();

    // Label the line
    const labelLineX = -5;
    const labelLineY = (5 * labelLineX + 12) / 3;
    const lpLine = toCanvas(labelLineX, labelLineY);
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold 13px Segoe UI, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('5x - 3y + 12 = 0', lpLine.x + 8, lpLine.y - 10);

    // Compute center
    const C = computeCenter(A, B);

    if (C) {
      const r2 = (C.x - A.x) * (C.x - A.x) + (C.y - A.y) * (C.y - A.y);
      const r = Math.sqrt(r2);

      // Draw circle
      const cc = toCanvas(C.x, C.y);
      ctx.strokeStyle = 'rgba(52, 211, 153, 0.6)';
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      ctx.arc(cc.x, cc.y, r * scale, 0, Math.PI * 2);
      ctx.stroke();

      // Draw perpendicular bisector (dashed)
      const mx = (A.x + B.x) / 2;
      const my = (A.y + B.y) / 2;
      const dx = B.x - A.x;
      const dy = B.y - A.y;

      ctx.strokeStyle = 'rgba(167, 139, 250, 0.5)';
      ctx.lineWidth = 1.5;
      ctx.setLineDash([6, 4]);
      ctx.beginPath();
      // Draw perpendicular bisector extended
      const t1 = -10, t2 = 10;
      const pb1 = toCanvas(mx - dy * t1, my + dx * t1);
      const pb2 = toCanvas(mx - dy * t2, my + dx * t2);
      ctx.moveTo(pb1.x, pb1.y);
      ctx.lineTo(pb2.x, pb2.y);
      ctx.stroke();
      ctx.setLineDash([]);

      // Label perpendicular bisector
      const labelPBx = mx - dy * 0.5;
      const labelPBy = my + dx * 0.5;
      const lpPB = toCanvas(labelPBx, labelPBy);
      ctx.fillStyle = '#a78bfa';
      ctx.font = '12px Segoe UI, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('simetrala AB', lpPB.x + 8, lpPB.y - 8);

      // Draw segment AB (dashed)
      ctx.strokeStyle = 'rgba(244, 114, 182, 0.5)';
      ctx.lineWidth = 1.5;
      ctx.setLineDash([5, 3]);
      const pa = toCanvas(A.x, A.y);
      const pb = toCanvas(B.x, B.y);
      ctx.beginPath();
      ctx.moveTo(pa.x, pa.y);
      ctx.lineTo(pb.x, pb.y);
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw radii (dashed)
      ctx.strokeStyle = 'rgba(52, 211, 153, 0.35)';
      ctx.lineWidth = 1;
      ctx.setLineDash([4, 4]);
      ctx.beginPath();
      ctx.moveTo(cc.x, cc.y);
      ctx.lineTo(pa.x, pa.y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(cc.x, cc.y);
      ctx.lineTo(pb.x, pb.y);
      ctx.stroke();
      ctx.setLineDash([]);

      // Midpoint M
      const mpt = toCanvas(mx, my);
      ctx.fillStyle = '#a78bfa';
      ctx.beginPath();
      ctx.arc(mpt.x, mpt.y, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#a78bfa';
      ctx.font = 'bold 13px Segoe UI, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('M(' + mx.toFixed(1) + ', ' + my.toFixed(1) + ')', mpt.x + 10, mpt.y - 8);

      // Center point C
      ctx.fillStyle = '#34d399';
      ctx.beginPath();
      ctx.arc(cc.x, cc.y, 7, 0, Math.PI * 2);
      ctx.fill();

      // Glow for center
      ctx.shadowColor = '#34d399';
      ctx.shadowBlur = 12;
      ctx.fillStyle = '#34d399';
      ctx.beginPath();
      ctx.arc(cc.x, cc.y, 4, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;

      ctx.fillStyle = '#4ade80';
      ctx.font = 'bold 14px Segoe UI, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('C(' + C.x.toFixed(1) + ', ' + C.y.toFixed(1) + ')', cc.x + 12, cc.y - 10);

      // Radius label
      ctx.fillStyle = '#34d399';
      ctx.font = '12px Segoe UI, sans-serif';
      ctx.textAlign = 'center';
      const rLabelX = (cc.x + pa.x) / 2;
      const rLabelY = (cc.y + pa.y) / 2;
      ctx.fillText('r = ' + r.toFixed(2), rLabelX - 25, rLabelY);
    }

    // Draw point A
    const pa = toCanvas(A.x, A.y);
    ctx.fillStyle = '#f472b6';
    ctx.beginPath();
    ctx.arc(pa.x, pa.y, 7, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#f472b6';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(pa.x, pa.y, 12, 0, Math.PI * 2);
    ctx.stroke();
    ctx.fillStyle = '#f472b6';
    ctx.font = 'bold 14px Segoe UI, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText('A(' + A.x.toFixed(0) + ', ' + A.y.toFixed(0) + ')', pa.x - 16, pa.y + 5);

    // Draw point B
    const pb = toCanvas(B.x, B.y);
    ctx.fillStyle = '#60a5fa';
    ctx.beginPath();
    ctx.arc(pb.x, pb.y, 7, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(pb.x, pb.y, 12, 0, Math.PI * 2);
    ctx.stroke();
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold 14px Segoe UI, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText('B(' + B.x.toFixed(0) + ', ' + B.y.toFixed(0) + ')', pb.x - 16, pb.y + 5);

    // Legend
    ctx.font = '12px Segoe UI, sans-serif';
    const legendX = 16;
    let legendY = 24;
    const items = [
      { color: '#60a5fa', label: 'Prava: 5x - 3y + 12 = 0' },
      { color: '#a78bfa', label: 'Simetrala duzi AB' },
      { color: '#34d399', label: 'Kruznica' },
      { color: '#f472b6', label: 'Tacka A (pomeri me!)' },
      { color: '#60a5fa', label: 'Tacka B (pomeri me!)' },
    ];
    for (const item of items) {
      ctx.fillStyle = item.color;
      ctx.beginPath();
      ctx.arc(legendX + 6, legendY - 4, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = item.color;
      ctx.textAlign = 'left';
      ctx.fillText(item.label, legendX + 18, legendY);
      legendY += 20;
    }

    // Info display
    if (C) {
      const r2 = (C.x - A.x) * (C.x - A.x) + (C.y - A.y) * (C.y - A.y);
      const pqr2 = C.x + C.y + r2;
      ctx.fillStyle = '#4ade80';
      ctx.font = 'bold 14px Segoe UI, sans-serif';
      ctx.textAlign = 'right';
      ctx.fillText('p + q + r\u00B2 = ' + pqr2.toFixed(1), W - 16, 28);
      ctx.fillStyle = '#94a3b8';
      ctx.font = '12px Segoe UI, sans-serif';
      ctx.fillText('r\u00B2 = ' + r2.toFixed(1), W - 16, 46);
    }
  }

  draw();

  // Step click interaction
  const steps = document.querySelectorAll('.step-container');
  steps.forEach(step => {
    step.addEventListener('click', () => {
      steps.forEach(s => s.classList.remove('active'));
      step.classList.add('active');
    });
  });
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{
  "title": "Centar kruznice na datoj pravoj kroz dve tacke",
  "subject": "math",
  "unit": "geometry",
  "topic_tags": ["kruznica", "analiticka geometrija", "simetrala duzi", "jednacina prave"]
}
BRAINSPARK_META-->