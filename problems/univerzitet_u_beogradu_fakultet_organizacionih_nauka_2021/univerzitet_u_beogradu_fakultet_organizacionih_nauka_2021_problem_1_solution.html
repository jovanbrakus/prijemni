<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepenovanje kompleksnog broja</title>

<script type="text/info" id="logic-scratchpad">
PROBLEM:
z = (3+i)/(4-2i) - (1-2i)/(3-i), i² = -1
Find z^2021.

STEP-BY-STEP LOGIC:

1. Compute first fraction: (3+i)/(4-2i)
   Multiply numerator and denominator by conjugate of denominator: (4+2i)
   Numerator: (3+i)(4+2i) = 12 + 6i + 4i + 2i² = 12 + 10i - 2 = 10 + 10i
   Denominator: (4-2i)(4+2i) = 16 - 4i² = 16 + 4 = 20
   First fraction = (10+10i)/20 = (1+i)/2

2. Compute second fraction: (1-2i)/(3-i)
   Multiply numerator and denominator by conjugate of denominator: (3+i)
   Numerator: (1-2i)(3+i) = 3 + i - 6i - 2i² = 3 - 5i + 2 = 5 - 5i
   Denominator: (3-i)(3+i) = 9 - i² = 9 + 1 = 10
   Second fraction = (5-5i)/10 = (1-i)/2

3. Compute z:
   z = (1+i)/2 - (1-i)/2
   z = [(1+i) - (1-i)] / 2
   z = [1 + i - 1 + i] / 2
   z = 2i / 2
   z = i

4. Compute z^2021 = i^2021:
   Powers of i cycle with period 4:
   i^1 = i
   i^2 = -1
   i^3 = -i
   i^4 = 1
   i^5 = i (cycle repeats)

   2021 = 4 × 505 + 1
   So i^2021 = i^1 = i

ANSWER: (E) i

Verification against all options:
(A) -(1+i)/√2 ✗
(B) 1 ✗
(C) -i ✗
(D) (i-1)/√2 ✗
(E) i ✓

Correct answer: (E) i
</script>

<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)'], ['$', '$']],
    displayMath: [['\\[', '\\]']]
  },
  svg: { fontCache: 'global' }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  line-height: 1.7;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 10px;
}

h1 {
  font-size: 2.2rem;
  font-weight: 800;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  text-align: center;
}

.subtitle {
  color: #94a3b8;
  text-align: center;
  font-size: 1.05rem;
  margin-bottom: 30px;
}

.card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
}

.card h2 {
  color: #60a5fa;
  font-size: 1.35rem;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card h3 {
  color: #e2e8f0;
  font-size: 1.1rem;
  margin-bottom: 10px;
}

.given-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 16px;
}

.given-item {
  background: rgba(56,189,248,0.06);
  border: 1px solid rgba(56,189,248,0.12);
  border-radius: 10px;
  padding: 12px 18px;
  min-width: 100px;
  text-align: center;
  flex: 1;
}

.given-item .label {
  color: #94a3b8;
  font-size: 0.85rem;
  margin-bottom: 4px;
  font-weight: 600;
}

.given-item .value {
  color: #e2e8f0;
  font-size: 1.1rem;
  font-weight: 600;
}

.answer-option {
  cursor: default;
}

.math-block {
  background: rgba(56,189,248,0.08);
  border: 1px solid rgba(56,189,248,0.15);
  border-radius: 10px;
  padding: 16px 20px;
  margin: 14px 0;
  font-family: 'Courier New', monospace;
  overflow-x: auto;
}

.plan-card {
  border-left: 4px solid #a78bfa;
}

.theory-card details {
  margin: 15px 0;
}

.theory-card summary {
  cursor: pointer;
  font-size: 1.05rem;
  font-weight: 600;
  color: #a78bfa;
  padding: 8px 0;
  user-select: none;
}

.theory-card ul {
  list-style: none;
  padding: 12px 0;
}

.theory-card li {
  padding: 8px 0;
  border-bottom: 1px solid rgba(51,65,85,0.5);
  color: #e2e8f0;
}

.theory-card li:last-child {
  border-bottom: none;
}

.step {
  display: flex;
  gap: 16px;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 12px;
  border-left: 3px solid transparent;
  transition: border-color 0.2s ease, background 0.2s ease;
}

.step:hover {
  border-left-color: #4ade80;
  background: rgba(74,222,128,0.04);
}

.step-badge {
  width: 32px;
  height: 32px;
  min-width: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, #60a5fa, #a78bfa);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.9rem;
  margin-top: 2px;
}

.step-content {
  flex: 1;
}

.step-content h3 {
  margin-bottom: 8px;
  color: #e2e8f0;
  font-size: 1.05rem;
}

.step-content p {
  color: #cbd5e1;
  margin-bottom: 8px;
}

.note {
  color: #94a3b8;
  font-size: 0.9rem;
  font-style: italic;
  margin-top: 6px;
}

.checkpoint {
  margin: 20px 0;
  background: rgba(167,139,250,0.06);
  border: 1px solid rgba(167,139,250,0.15);
  border-radius: 10px;
  padding: 14px 18px;
}

.checkpoint summary {
  cursor: pointer;
  color: #a78bfa;
  font-weight: 600;
  font-size: 0.95rem;
  user-select: none;
}

.checkpoint .answer {
  padding-top: 10px;
  color: #4ade80;
  font-weight: 600;
}

.insight-card {
  background: linear-gradient(135deg, rgba(96,165,250,0.1), rgba(167,139,250,0.1));
  border: 1px solid rgba(96,165,250,0.25);
  text-align: center;
  padding: 28px;
}

.insight-card .big-formula {
  font-size: 1.4rem;
  margin: 16px 0;
  color: #4ade80;
}

.final-answer-card {
  border: 2px solid #4ade80;
  background: linear-gradient(135deg, rgba(52,211,153,0.08), rgba(74,222,128,0.04));
  text-align: center;
  padding: 28px;
}

.final-answer-card h2 {
  color: #4ade80;
  justify-content: center;
}

.final-answer-value {
  font-size: 1.8rem;
  color: #4ade80;
  font-weight: 800;
  margin: 16px 0;
}

.options-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  justify-content: center;
  margin: 20px 0;
}

.option-card {
  padding: 10px 22px;
  border-radius: 10px;
  border: 2px solid #334155;
  background: #1e293b;
  color: #94a3b8;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.2s ease;
}

.option-card.correct {
  border-color: #4ade80;
  background: rgba(74,222,128,0.1);
  color: #4ade80;
  box-shadow: 0 0 20px rgba(74,222,128,0.15);
}

.verification-note {
  color: #94a3b8;
  font-size: 0.92rem;
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid #334155;
  text-align: left;
}

.pitfall-list {
  list-style: none;
  padding: 0;
}

.pitfall-list li {
  padding: 10px 0;
  border-bottom: 1px solid rgba(51,65,85,0.5);
  color: #cbd5e1;
}

.pitfall-list li:last-child {
  border-bottom: none;
}

.pitfall-label {
  color: #e09468;
  font-weight: 700;
  margin-right: 6px;
}

.challenge-card {
  border-left: 4px solid #f472b6;
}

.challenge-card details {
  margin: 15px 0;
}

.challenge-card summary {
  cursor: pointer;
  color: #f472b6;
  font-weight: 600;
  user-select: none;
}

canvas {
  display: block;
  margin: 0 auto;
  border-radius: 12px;
  touch-action: none;
  width: 100%;
}

.canvas-hint {
  text-align: center;
  color: #64748b;
  font-size: 0.85rem;
  margin-top: 8px;
}

.highlight-pink {
  color: #f472b6;
  font-weight: 600;
}

.highlight-blue {
  color: #60a5fa;
  font-weight: 600;
}

.highlight-green {
  color: #4ade80;
  font-weight: 600;
}

@media (max-width: 700px) {
  h1 { font-size: 1.6rem; }
  .card { padding: 16px; }
  .step { padding: 12px; flex-direction: column; gap: 8px; }
  .given-grid { gap: 8px; }
  .given-item { min-width: 70px; padding: 10px 12px; }
  .final-answer-value { font-size: 1.4rem; }
  .options-row { gap: 8px; }
  .option-card { padding: 8px 14px; font-size: 0.9rem; }
}
</style>
</head>
<body>
<div class="container">

  <!-- Title -->
  <h1>Stepenovanje kompleksnog broja</h1>
  <p class="subtitle">Kompleksni brojevi &mdash; racionalizacija imenioca, razlika razlomaka i ciklicnost stepena imaginarne jedinice</p>

  <!-- Problem Statement -->
  <div class="card problem-statement">
    <h2>Postavka zadatka</h2>
    <p>
      Ako je
    </p>
    <div class="math-block">
      \[ z = \frac{3+i}{4-2i} - \frac{1-2i}{3-i}, \quad i^2 = -1 \]
    </div>
    <p>onda je \(z^{2021}\) jednako:</p>

    <div class="given-grid">
      <div class="given-item answer-option" data-option="A">
        <div class="label">(A)</div>
        <div class="value">\(-\dfrac{1+i}{\sqrt{2}}\)</div>
      </div>
      <div class="given-item answer-option" data-option="B">
        <div class="label">(B)</div>
        <div class="value">\(1\)</div>
      </div>
      <div class="given-item answer-option" data-option="C">
        <div class="label">(C)</div>
        <div class="value">\(-i\)</div>
      </div>
      <div class="given-item answer-option" data-option="D">
        <div class="label">(D)</div>
        <div class="value">\(\dfrac{i-1}{\sqrt{2}}\)</div>
      </div>
      <div class="given-item answer-option" data-option="E">
        <div class="label">(E)</div>
        <div class="value">\(i\)</div>
      </div>
    </div>
  </div>

  <!-- Plan -->
  <div class="card plan-card">
    <h2>Plan resavanja</h2>
    <p>
      Svaki razlomak cemo racionalizovati mnozenjem brojioca i imenioca konjugovanim kompleksnim brojem imenioca.
      Zatim cemo oduzeti dobijene razlomke da nadjemo \(z\), pa iskoristiti ciklicnost stepena imaginarne jedinice
      da izracunamo \(z^{2021}\).
    </p>
  </div>

  <!-- Theory Refresher -->
  <div class="card theory-card">
    <details>
      <summary>Kljucne formule i teoreme</summary>
      <ul>
        <li>
          <strong>Konjugovani kompleksni broj:</strong>
          Konjugat broja \(a + bi\) je \(\overline{a+bi} = a - bi\).
        </li>
        <li>
          <strong>Racionalizacija imenioca:</strong>
          \[ \frac{a+bi}{c+di} = \frac{(a+bi)(c-di)}{(c+di)(c-di)} = \frac{(a+bi)(c-di)}{c^2 + d^2} \]
          jer je \((c+di)(c-di) = c^2 - (di)^2 = c^2 + d^2\).
        </li>
        <li>
          <strong>Ciklicnost stepena imaginarne jedinice:</strong>
          \[ i^1 = i, \quad i^2 = -1, \quad i^3 = -i, \quad i^4 = 1 \]
          Stepeni se ponavljaju sa periodom 4: \(i^n = i^{n \bmod 4}\).
        </li>
        <li>
          <strong>Mnozenje kompleksnih brojeva:</strong>
          \[ (a+bi)(c+di) = (ac - bd) + (ad + bc)i \]
        </li>
      </ul>
    </details>
  </div>

  <!-- Visual Aid: Complex Plane -->
  <div class="card">
    <h2>Vizuelni prikaz</h2>
    <p style="color:#94a3b8; margin-bottom: 14px;">
      Kompleksna ravan prikazuje sve medjurezultate i konacni rezultat \(z = i\), kao i ciklicnost stepena od \(i\).
    </p>
    <canvas id="complexPlane" width="800" height="500"></canvas>
    <p class="canvas-hint">Prikaz kompleksnih brojeva na kompleksnoj ravni i ciklus stepena broja \(i\)</p>
  </div>

  <!-- Step-by-step Solution -->
  <div class="card">
    <h2>Resenje korak po korak</h2>

    <!-- Step 1 -->
    <div class="step">
      <div class="step-badge">1</div>
      <div class="step-content">
        <h3>Racionalizujemo prvi razlomak \(\dfrac{3+i}{4-2i}\)</h3>
        <p>
          Konjugat imenioca \(4 - 2i\) je \(4 + 2i\). Mnozimo i brojilac i imenilac tim izrazom:
        </p>
        <div class="math-block">
          \[ \frac{3+i}{4-2i} = \frac{(3+i)(4+2i)}{(4-2i)(4+2i)} \]
        </div>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="step">
      <div class="step-badge">2</div>
      <div class="step-content">
        <h3>Racunamo imenilac prvog razlomka</h3>
        <p>
          Koristimo formulu za proizvod broja i njegovog konjugata:
        </p>
        <div class="math-block">
          \[ (4-2i)(4+2i) = 4^2 + 2^2 = 16 + 4 = 20 \]
        </div>
        <p class="note">
          Podsetimo se: \((a-bi)(a+bi) = a^2 + b^2\), uvek realan i pozitivan broj.
        </p>
      </div>
    </div>

    <!-- Step 3 -->
    <div class="step">
      <div class="step-badge">3</div>
      <div class="step-content">
        <h3>Racunamo brojilac prvog razlomka</h3>
        <p>
          Mnozimo zagrade:
        </p>
        <div class="math-block">
          \[ (3+i)(4+2i) = 3 \cdot 4 + 3 \cdot 2i + i \cdot 4 + i \cdot 2i \]
        </div>
        <div class="math-block">
          \[ = 12 + 6i + 4i + 2i^2 \]
        </div>
        <p>
          Zamenjujemo \(i^2 = -1\):
        </p>
        <div class="math-block">
          \[ = 12 + 10i + 2 \cdot (-1) = 12 + 10i - 2 = 10 + 10i \]
        </div>
      </div>
    </div>

    <!-- Step 4 -->
    <div class="step">
      <div class="step-badge">4</div>
      <div class="step-content">
        <h3>Zapisujemo rezultat prvog razlomka</h3>
        <p>
          Delimo brojilac imeniocem:
        </p>
        <div class="math-block">
          \[ \frac{3+i}{4-2i} = \frac{10+10i}{20} = \frac{10}{20} + \frac{10}{20}\,i = \frac{1+i}{2} \]
        </div>
      </div>
    </div>

    <!-- Checkpoint 1 -->
    <details class="checkpoint">
      <summary>Proveri se: Koliki je realni, a koliki imaginarni deo prvog razlomka?</summary>
      <div class="answer">
        Realni deo je \(\dfrac{1}{2}\), a imaginarni deo je \(\dfrac{1}{2}\). Dakle, prvi razlomak je \(\dfrac{1}{2} + \dfrac{1}{2}\,i\).
      </div>
    </details>

    <!-- Step 5 -->
    <div class="step">
      <div class="step-badge">5</div>
      <div class="step-content">
        <h3>Racionalizujemo drugi razlomak \(\dfrac{1-2i}{3-i}\)</h3>
        <p>
          Konjugat imenioca \(3 - i\) je \(3 + i\). Mnozimo:
        </p>
        <div class="math-block">
          \[ \frac{1-2i}{3-i} = \frac{(1-2i)(3+i)}{(3-i)(3+i)} \]
        </div>
      </div>
    </div>

    <!-- Step 6 -->
    <div class="step">
      <div class="step-badge">6</div>
      <div class="step-content">
        <h3>Racunamo imenilac drugog razlomka</h3>
        <div class="math-block">
          \[ (3-i)(3+i) = 3^2 + 1^2 = 9 + 1 = 10 \]
        </div>
      </div>
    </div>

    <!-- Step 7 -->
    <div class="step">
      <div class="step-badge">7</div>
      <div class="step-content">
        <h3>Racunamo brojilac drugog razlomka</h3>
        <p>
          Mnozimo zagrade:
        </p>
        <div class="math-block">
          \[ (1-2i)(3+i) = 1 \cdot 3 + 1 \cdot i - 2i \cdot 3 - 2i \cdot i \]
        </div>
        <div class="math-block">
          \[ = 3 + i - 6i - 2i^2 \]
        </div>
        <p>
          Zamenjujemo \(i^2 = -1\):
        </p>
        <div class="math-block">
          \[ = 3 - 5i - 2 \cdot (-1) = 3 - 5i + 2 = 5 - 5i \]
        </div>
      </div>
    </div>

    <!-- Step 8 -->
    <div class="step">
      <div class="step-badge">8</div>
      <div class="step-content">
        <h3>Zapisujemo rezultat drugog razlomka</h3>
        <div class="math-block">
          \[ \frac{1-2i}{3-i} = \frac{5-5i}{10} = \frac{5}{10} - \frac{5}{10}\,i = \frac{1-i}{2} \]
        </div>
      </div>
    </div>

    <!-- Checkpoint 2 -->
    <details class="checkpoint">
      <summary>Proveri se: Koliko je \(\dfrac{1+i}{2} - \dfrac{1-i}{2}\)?</summary>
      <div class="answer">
        \(\dfrac{(1+i) - (1-i)}{2} = \dfrac{1 + i - 1 + i}{2} = \dfrac{2i}{2} = i\)
      </div>
    </details>

    <!-- Step 9 -->
    <div class="step">
      <div class="step-badge">9</div>
      <div class="step-content">
        <h3>Nalazimo \(z\) &mdash; razliku dva razlomka</h3>
        <p>
          Oduzimamo drugi razlomak od prvog:
        </p>
        <div class="math-block">
          \[ z = \frac{1+i}{2} - \frac{1-i}{2} = \frac{(1+i) - (1-i)}{2} \]
        </div>
        <p>
          Rastvaramo zagradu (pazimo na minus ispred):
        </p>
        <div class="math-block">
          \[ = \frac{1 + i - 1 + i}{2} = \frac{2i}{2} = i \]
        </div>
        <p>
          Dakle, <span class="highlight-green">\(z = i\)</span>.
        </p>
      </div>
    </div>

    <!-- Step 10 -->
    <div class="step">
      <div class="step-badge">10</div>
      <div class="step-content">
        <h3>Racunamo \(z^{2021} = i^{2021}\)</h3>
        <p>
          Stepeni imaginarne jedinice se ponavljaju sa periodom 4:
        </p>
        <div class="math-block">
          \[ i^1 = i, \quad i^2 = -1, \quad i^3 = -i, \quad i^4 = 1, \quad i^5 = i, \;\ldots \]
        </div>
        <p>
          Da bismo nasli \(i^{2021}\), odredjujemo ostatak pri deljenju eksponenta sa 4:
        </p>
        <div class="math-block">
          \[ 2021 = 4 \cdot 505 + 1 \]
        </div>
        <p>
          Ostatak je <span class="highlight-blue">1</span>, pa je:
        </p>
        <div class="math-block">
          \[ i^{2021} = i^{4 \cdot 505 + 1} = (i^4)^{505} \cdot i^1 = 1^{505} \cdot i = i \]
        </div>
      </div>
    </div>

    <!-- Checkpoint 3 -->
    <details class="checkpoint">
      <summary>Proveri se: Koliko je \(i^{2024}\)?</summary>
      <div class="answer">
        \(2024 = 4 \cdot 506 + 0\), pa je \(i^{2024} = i^0 = 1\).
      </div>
    </details>
  </div>

  <!-- Key Insight -->
  <div class="card insight-card">
    <h2 style="justify-content: center;">Kljucno zapazanje</h2>
    <p>
      Oba razlomka nakon racionalizacije imaju isti imenilac 2, sto znatno pojednostavljuje oduzimanje.
      Realni delovi se potiru (\(1 - 1 = 0\)), a imaginarni se sabiraju (\(i + i = 2i\)),
      dajuci nam elegantan rezultat <span class="highlight-green">\(z = i\)</span>.
      Zatim, ciklicnost stepena od \(i\) sa periodom 4 omogucava da odmah odredimo bilo koji stepen.
    </p>
    <div class="big-formula">
      \[ z^{2021} = i^{2021} = i^{4 \cdot 505 + 1} = i \]
    </div>
  </div>

  <!-- Final Answer -->
  <div class="card final-answer-card">
    <h2>Konacan odgovor</h2>
    <div class="final-answer-value">
      \( z^{2021} = i \)
    </div>
    <p style="color:#94a3b8; margin-bottom: 14px;">Tacan odgovor je <strong style="color:#4ade80;">E)</strong></p>
    <div class="options-row">
      <div class="option-card">(A) \(-\dfrac{1+i}{\sqrt{2}}\)</div>
      <div class="option-card">(B) \(1\)</div>
      <div class="option-card">(C) \(-i\)</div>
      <div class="option-card">(D) \(\dfrac{i-1}{\sqrt{2}}\)</div>
      <div class="option-card correct">(E) \(i\) &#10003;</div>
    </div>
    <p class="verification-note">
      <strong>Verifikacija:</strong>
      Prvi razlomak: \(\frac{3+i}{4-2i} = \frac{10+10i}{20} = \frac{1+i}{2}\).
      Drugi razlomak: \(\frac{1-2i}{3-i} = \frac{5-5i}{10} = \frac{1-i}{2}\).
      Razlika: \(z = \frac{1+i}{2} - \frac{1-i}{2} = i\).
      Stepen: \(2021 \div 4 = 505\) sa ostatkom \(1\), pa \(i^{2021} = i\).
      Odgovor (E) je tacan.
    </p>
  </div>

  <!-- Common Pitfalls -->
  <div class="card">
    <h2>Ceste greske</h2>
    <ul class="pitfall-list">
      <li>
        <span class="pitfall-label">Greska 1:</span>
        Pogresan znak pri racionalizaciji. Prilikom mnozenja \((1-2i)(3+i)\), cesto se pogresi sa
        clanom \(-2i \cdot i = -2i^2\). Posto je \(i^2 = -1\), to daje \(+2\), a ne \(-2\).
        Greska u znaku tu menja ceo rezultat.
      </li>
      <li>
        <span class="pitfall-label">Greska 2:</span>
        Zaboravljanje na ciklicnost stepena od \(i\). Umesto da se trazi ostatak pri deljenju
        eksponenta sa 4, mnogi ucenici pokusavaju da direktno racunaju \(i^{2021}\), sto je nepotrebno.
        Dovoljno je znati da \(2021 = 4 \cdot 505 + 1\).
      </li>
    </ul>
  </div>

  <!-- Optional Challenge -->
  <div class="card challenge-card">
    <h2>Dodatni izazov</h2>
    <p>
      Koliko je \(z^{2023} + z^{2022} + z^{2021} + z^{2020}\) za isto \(z\)?
    </p>
    <details>
      <summary>Nagovestaj</summary>
      <p style="padding-top: 10px; color: #cbd5e1;">
        Posto je \(z = i\), treba naci \(i^{2023} + i^{2022} + i^{2021} + i^{2020}\).
        Nadji ostatke pri deljenju svakog eksponenta sa 4: dobices \(i^3 + i^2 + i^1 + i^0 = -i + (-1) + i + 1\).
        Sta primecujes?
      </p>
    </details>
  </div>

</div>

<script>
(() => {
  const canvas = document.getElementById('complexPlane');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');

  function draw() {
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    const W = rect.width;
    const H = 500;

    canvas.width = W * dpr;
    canvas.height = H * dpr;
    canvas.style.height = H + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    ctx.clearRect(0, 0, W, H);

    // Background
    ctx.fillStyle = '#0c1222';
    ctx.fillRect(0, 0, W, H);

    const s = Math.min(W / 800, 1);

    // Coordinate system
    const originX = W * 0.35;
    const originY = H * 0.55;
    const scale = 120 * s;

    function toCanvas(re, im) {
      return { x: originX + re * scale, y: originY - im * scale };
    }

    // Grid lines
    ctx.strokeStyle = '#1e293b';
    ctx.lineWidth = 1;
    for (let i = -3; i <= 3; i++) {
      // Vertical
      let p = toCanvas(i, 0);
      ctx.beginPath();
      ctx.moveTo(p.x, 20);
      ctx.lineTo(p.x, H - 20);
      ctx.stroke();
      // Horizontal
      p = toCanvas(0, i);
      ctx.beginPath();
      ctx.moveTo(20, p.y);
      ctx.lineTo(W - 20, p.y);
      ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = '#475569';
    ctx.lineWidth = 1.5;
    // Re axis
    ctx.beginPath();
    ctx.moveTo(20, originY);
    ctx.lineTo(W - 20, originY);
    ctx.stroke();
    // Im axis
    ctx.beginPath();
    ctx.moveTo(originX, 20);
    ctx.lineTo(originX, H - 20);
    ctx.stroke();

    // Axis labels
    ctx.fillStyle = '#94a3b8';
    ctx.font = (14 * s) + 'px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Re', W - 30, originY - 10);
    ctx.fillText('Im', originX + 18, 30);

    // Tick labels on Re axis
    ctx.font = (11 * s) + 'px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    for (let i = -2; i <= 2; i++) {
      if (i === 0) continue;
      let p = toCanvas(i, 0);
      ctx.fillStyle = '#64748b';
      ctx.fillText(String(i), p.x, originY + 6);
      // Tick mark
      ctx.beginPath();
      ctx.moveTo(p.x, originY - 3);
      ctx.lineTo(p.x, originY + 3);
      ctx.strokeStyle = '#64748b';
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    // Tick labels on Im axis
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    for (let i = -2; i <= 2; i++) {
      if (i === 0) continue;
      let p = toCanvas(0, i);
      ctx.fillStyle = '#64748b';
      ctx.fillText(i + 'i', originX - 8, p.y);
      // Tick mark
      ctx.beginPath();
      ctx.moveTo(originX - 3, p.y);
      ctx.lineTo(originX + 3, p.y);
      ctx.strokeStyle = '#64748b';
      ctx.lineWidth = 1;
      ctx.stroke();
    }

    // Origin label
    ctx.fillStyle = '#64748b';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'top';
    ctx.fillText('0', originX - 6, originY + 5);

    // Helper: draw a point with label
    function drawPoint(re, im, color, label, labelDx, labelDy) {
      const p = toCanvas(re, im);
      // Glow
      const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 18 * s);
      grad.addColorStop(0, color + '66');
      grad.addColorStop(1, color + '00');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(p.x, p.y, 18 * s, 0, 2 * Math.PI);
      ctx.fill();

      // Dot
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, 5 * s, 0, 2 * Math.PI);
      ctx.fill();

      // Label
      ctx.fillStyle = color;
      ctx.font = 'bold ' + (13 * s) + 'px Segoe UI, system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'bottom';
      ctx.fillText(label, p.x + (labelDx || 10) * s, p.y + (labelDy || -6) * s);
    }

    // Draw the intermediate results
    // First fraction: (1+i)/2 = (0.5, 0.5)
    drawPoint(0.5, 0.5, '#60a5fa', '(1+i)/2', 10, -8);

    // Second fraction: (1-i)/2 = (0.5, -0.5)
    drawPoint(0.5, -0.5, '#a78bfa', '(1-i)/2', 10, 14);

    // Dashed line between the two fractions
    const p1 = toCanvas(0.5, 0.5);
    const p2 = toCanvas(0.5, -0.5);
    ctx.setLineDash([6, 4]);
    ctx.strokeStyle = '#64748b';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(p1.x, p1.y);
    ctx.lineTo(p2.x, p2.y);
    ctx.stroke();
    ctx.setLineDash([]);

    // Midpoint label
    ctx.fillStyle = '#64748b';
    ctx.font = (11 * s) + 'px Segoe UI, system-ui, sans-serif';
    ctx.textAlign = 'left';
    const mid = toCanvas(0.5, 0);
    ctx.fillText('razlika', mid.x + 10 * s, mid.y + 4 * s);

    // z = i (the result!)
    drawPoint(0, 1, '#4ade80', 'z = i', 10, -8);

    // ---- Unit circle for i powers ----
    // Draw unit circle
    ctx.strokeStyle = 'rgba(52,211,153,0.2)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    const uc = toCanvas(0, 0);
    ctx.arc(uc.x, uc.y, scale, 0, 2 * Math.PI);
    ctx.stroke();

    // Draw the 4 cycle points with arrows
    const cyclePoints = [
      { re: 1, im: 0, label: 'i\u2070 = 1', color: '#94a3b8' },
      { re: 0, im: 1, label: 'i\u00B9 = i', color: '#4ade80' },
      { re: -1, im: 0, label: 'i\u00B2 = -1', color: '#94a3b8' },
      { re: 0, im: -1, label: 'i\u00B3 = -i', color: '#94a3b8' }
    ];

    // Draw arrows showing the cycle
    ctx.strokeStyle = 'rgba(52,211,153,0.3)';
    ctx.lineWidth = 1.5;
    for (let idx = 0; idx < 4; idx++) {
      const cur = cyclePoints[idx];
      const nxt = cyclePoints[(idx + 1) % 4];
      const cp = toCanvas(cur.re, cur.im);
      const np = toCanvas(nxt.re, nxt.im);

      // Draw arc arrow
      const angle1 = Math.atan2(-(cur.im), cur.re);
      const angle2 = Math.atan2(-(nxt.im), nxt.re);

      ctx.beginPath();
      const arcR = scale * 0.85;
      // Arc from current to next (clockwise in canvas = counterclockwise in math)
      let startA = -Math.atan2(cur.im, cur.re) + 0.15;
      let endA = -Math.atan2(nxt.im, nxt.re) - 0.15;
      if (endA < startA) endA += 2 * Math.PI;
      ctx.arc(uc.x, uc.y, arcR, startA, endA);
      ctx.stroke();

      // Arrowhead
      const tipAngle = endA;
      const tipX = uc.x + arcR * Math.cos(tipAngle);
      const tipY = uc.y + arcR * Math.sin(tipAngle);
      const arrLen = 8 * s;
      const arrAngle = tipAngle + Math.PI / 2;
      ctx.beginPath();
      ctx.moveTo(tipX, tipY);
      ctx.lineTo(tipX - arrLen * Math.cos(arrAngle - 0.5), tipY - arrLen * Math.sin(arrAngle - 0.5));
      ctx.moveTo(tipX, tipY);
      ctx.lineTo(tipX - arrLen * Math.cos(arrAngle + 0.5), tipY - arrLen * Math.sin(arrAngle + 0.5));
      ctx.stroke();
    }

    // Draw cycle point dots and labels
    cyclePoints.forEach(function(pt) {
      const p = toCanvas(pt.re, pt.im);
      // Small circle
      ctx.fillStyle = pt.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, 4 * s, 0, 2 * Math.PI);
      ctx.fill();

      // Label positioning
      ctx.fillStyle = pt.color;
      ctx.font = (12 * s) + 'px Segoe UI, system-ui, sans-serif';
      let lx = p.x;
      let ly = p.y;
      if (pt.re === 1) { ctx.textAlign = 'left'; lx += 10 * s; ly += 4 * s; }
      else if (pt.re === -1) { ctx.textAlign = 'right'; lx -= 10 * s; ly += 4 * s; }
      else if (pt.im === 1) { ctx.textAlign = 'center'; ly -= 14 * s; }
      else { ctx.textAlign = 'center'; ly += 20 * s; }
      ctx.fillText(pt.label, lx, ly);
    });

    // Highlight i^2021 = i
    const highlightP = toCanvas(0, 1);
    ctx.strokeStyle = '#4ade80';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(highlightP.x, highlightP.y, 12 * s, 0, 2 * Math.PI);
    ctx.stroke();

    // Title annotation in the right area
    const rightX = W * 0.72;
    const topY = 60 * s;

    // Box for the summary
    function roundedBox(x, y, w, h, rad, fillColor, strokeColor) {
      ctx.beginPath();
      ctx.moveTo(x + rad, y);
      ctx.lineTo(x + w - rad, y);
      ctx.arcTo(x + w, y, x + w, y + rad, rad);
      ctx.lineTo(x + w, y + h - rad);
      ctx.arcTo(x + w, y + h, x + w - rad, y + h, rad);
      ctx.lineTo(x + rad, y + h);
      ctx.arcTo(x, y + h, x, y + h - rad, rad);
      ctx.lineTo(x, y + rad);
      ctx.arcTo(x, y, x + rad, y, rad);
      ctx.closePath();
      if (fillColor) { ctx.fillStyle = fillColor; ctx.fill(); }
      if (strokeColor) { ctx.strokeStyle = strokeColor; ctx.lineWidth = 1.5; ctx.stroke(); }
    }

    const boxW = 190 * s;
    const boxH = 130 * s;
    const boxX = rightX - boxW / 2;
    const boxY = topY;

    roundedBox(boxX, boxY, boxW, boxH, 10 * s, 'rgba(30,41,59,0.9)', '#334155');

    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillStyle = '#60a5fa';
    ctx.font = 'bold ' + (13 * s) + 'px Segoe UI, system-ui, sans-serif';
    ctx.fillText('Racun:', boxX + boxW / 2, boxY + 10 * s);

    ctx.fillStyle = '#cbd5e1';
    ctx.font = (11 * s) + 'px Segoe UI, system-ui, sans-serif';
    const lines = [
      '(1+i)/2 - (1-i)/2',
      '= (1+i-1+i)/2',
      '= 2i/2 = i',
      '',
      '2021 = 4\u00D7505 + 1',
      'i\u00B2\u2070\u00B2\u00B9 = i'
    ];
    lines.forEach(function(line, idx) {
      ctx.fillStyle = idx === 5 ? '#4ade80' : '#cbd5e1';
      ctx.font = (idx === 5 ? 'bold ' : '') + (11 * s) + 'px Segoe UI, system-ui, sans-serif';
      ctx.fillText(line, boxX + boxW / 2, boxY + 30 * s + idx * 16 * s);
    });
  }

  draw();
  window.addEventListener('resize', draw);
})();
</script>
</body>
</html>
<!--BRAINSPARK_META
{
  "title": "Stepenovanje kompleksnog broja z^2021",
  "subject": "math",
  "unit": "algebra",
  "topic_tags": ["kompleksni brojevi", "racionalizacija imenioca", "imaginarna jedinica", "ciklicnost stepena", "konjugovani kompleksni broj"]
}
BRAINSPARK_META-->